var Bu=Object.create;var Yt=Object.defineProperty,Ou=Object.defineProperties,Lu=Object.getOwnPropertyDescriptor,Du=Object.getOwnPropertyDescriptors,Wu=Object.getOwnPropertyNames,Yo=Object.getOwnPropertySymbols,Iu=Object.getPrototypeOf,Xo=Object.prototype.hasOwnProperty,Fu=Object.prototype.propertyIsEnumerable;var Qo=(s,t,n)=>t in s?Yt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,X=(s,t)=>{for(var n in t||(t={}))Xo.call(t,n)&&Qo(s,n,t[n]);if(Yo)for(var n of Yo(t))Fu.call(t,n)&&Qo(s,n,t[n]);return s},Ee=(s,t)=>Ou(s,Du(t)),Ko=s=>Yt(s,"__esModule",{value:!0});var Qt=(s,t)=>()=>(s&&(t=s(s=0)),t);var H=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),Zo=(s,t)=>{for(var n in t)Yt(s,n,{get:t[n],enumerable:!0})},Jo=(s,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Wu(t))!Xo.call(s,a)&&(n||a!=="default")&&Yt(s,a,{get:()=>t[a],enumerable:!(o=Lu(t,a))||o.enumerable});return s},tt=(s,t)=>Jo(Ko(Yt(s!=null?Bu(Iu(s)):{},"default",!t&&s&&s.__esModule?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s),qu=(s=>(t,n)=>s&&s.get(t)||(n=Jo(Ko({}),t,1),s&&s.set(t,n),n))(typeof WeakMap!="undefined"?new WeakMap:0);var ri=H((Qr,ti)=>{(function(s,t){typeof Qr=="object"&&typeof ti<"u"?t(Qr):typeof define=="function"&&define.amd?define(["exports"],t):(s=typeof globalThis<"u"?globalThis:s||self,t(s.WebStreamsPolyfill={}))})(Qr,function(s){"use strict";let t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:e=>`Symbol(${e})`;function n(){}function o(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}let a=o();function l(e){return typeof e=="object"&&e!==null||typeof e=="function"}let f=n,m=Promise,d=Promise.prototype.then,h=Promise.resolve.bind(m),b=Promise.reject.bind(m);function g(e){return new m(e)}function w(e){return h(e)}function S(e){return b(e)}function y(e,r,i){return d.call(e,r,i)}function T(e,r,i){y(y(e,r,i),void 0,f)}function P(e,r){T(e,r)}function A(e,r){T(e,void 0,r)}function D(e,r,i){return y(e,r,i)}function N(e){y(e,void 0,f)}let W=(()=>{let e=a&&a.queueMicrotask;if(typeof e=="function")return e;let r=w(void 0);return i=>y(r,i)})();function M(e,r,i){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,r,i)}function I(e,r,i){try{return w(M(e,r,i))}catch(u){return S(u)}}let ae=16384;class V{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(r){let i=this._back,u=i;i._elements.length===ae-1&&(u={_elements:[],_next:void 0}),i._elements.push(r),u!==i&&(this._back=u,i._next=u),++this._size}shift(){let r=this._front,i=r,u=this._cursor,c=u+1,p=r._elements,_=p[u];return c===ae&&(i=r._next,c=0),--this._size,this._cursor=c,r!==i&&(this._front=i),p[u]=void 0,_}forEach(r){let i=this._cursor,u=this._front,c=u._elements;for(;(i!==c.length||u._next!==void 0)&&!(i===c.length&&(u=u._next,c=u._elements,i=0,c.length===0));)r(c[i]),++i}peek(){let r=this._front,i=this._cursor;return r._elements[i]}}function _r(e,r){e._ownerReadableStream=r,r._reader=e,r._state==="readable"?yn(e):r._state==="closed"?il(e):Ls(e,r._storedError)}function bn(e,r){let i=e._ownerReadableStream;return fe(i,r)}function ge(e){e._ownerReadableStream._state==="readable"?gn(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):al(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function ut(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function yn(e){e._closedPromise=g((r,i)=>{e._closedPromise_resolve=r,e._closedPromise_reject=i})}function Ls(e,r){yn(e),gn(e,r)}function il(e){yn(e),Ds(e)}function gn(e,r){e._closedPromise_reject!==void 0&&(N(e._closedPromise),e._closedPromise_reject(r),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function al(e,r){Ls(e,r)}function Ds(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let Ws=t("[[AbortSteps]]"),Is=t("[[ErrorSteps]]"),Sn=t("[[CancelSteps]]"),wn=t("[[PullSteps]]"),Fs=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},ll=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function ul(e){return typeof e=="object"||typeof e=="function"}function Se(e,r){if(e!==void 0&&!ul(e))throw new TypeError(`${r} is not an object.`)}function le(e,r){if(typeof e!="function")throw new TypeError(`${r} is not a function.`)}function fl(e){return typeof e=="object"&&e!==null||typeof e=="function"}function qs(e,r){if(!fl(e))throw new TypeError(`${r} is not an object.`)}function we(e,r,i){if(e===void 0)throw new TypeError(`Parameter ${r} is required in '${i}'.`)}function Rn(e,r,i){if(e===void 0)throw new TypeError(`${r} is required in '${i}'.`)}function Tn(e){return Number(e)}function Ns(e){return e===0?0:e}function cl(e){return Ns(ll(e))}function Ms(e,r){let u=Number.MAX_SAFE_INTEGER,c=Number(e);if(c=Ns(c),!Fs(c))throw new TypeError(`${r} is not a finite number`);if(c=cl(c),c<0||c>u)throw new TypeError(`${r} is outside the accepted range of ${0} to ${u}, inclusive`);return!Fs(c)||c===0?0:c}function En(e,r){if(!Ie(e))throw new TypeError(`${r} is not a ReadableStream.`)}function ft(e){return new Lt(e)}function Us(e,r){e._reader._readRequests.push(r)}function Cn(e,r,i){let c=e._reader._readRequests.shift();i?c._closeSteps():c._chunkSteps(r)}function br(e){return e._reader._readRequests.length}function $s(e){let r=e._reader;return!(r===void 0||!Oe(r))}class Lt{constructor(r){if(we(r,1,"ReadableStreamDefaultReader"),En(r,"First parameter"),Fe(r))throw new TypeError("This stream has already been locked for exclusive reading by another reader");_r(this,r),this._readRequests=new V}get closed(){return Oe(this)?this._closedPromise:S(yr("closed"))}cancel(r=void 0){return Oe(this)?this._ownerReadableStream===void 0?S(ut("cancel")):bn(this,r):S(yr("cancel"))}read(){if(!Oe(this))return S(yr("read"));if(this._ownerReadableStream===void 0)return S(ut("read from"));let r,i,u=g((p,_)=>{r=p,i=_});return Dt(this,{_chunkSteps:p=>r({value:p,done:!1}),_closeSteps:()=>r({value:void 0,done:!0}),_errorSteps:p=>i(p)}),u}releaseLock(){if(!Oe(this))throw yr("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");ge(this)}}}Object.defineProperties(Lt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Lt.prototype,t.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Oe(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof Lt}function Dt(e,r){let i=e._ownerReadableStream;i._disturbed=!0,i._state==="closed"?r._closeSteps():i._state==="errored"?r._errorSteps(i._storedError):i._readableStreamController[wn](r)}function yr(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let zs=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class js{constructor(r,i){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=r,this._preventCancel=i}next(){let r=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?D(this._ongoingPromise,r,r):r(),this._ongoingPromise}return(r){let i=()=>this._returnSteps(r);return this._ongoingPromise?D(this._ongoingPromise,i,i):i()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let r=this._reader;if(r._ownerReadableStream===void 0)return S(ut("iterate"));let i,u,c=g((_,R)=>{i=_,u=R});return Dt(r,{_chunkSteps:_=>{this._ongoingPromise=void 0,W(()=>i({value:_,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,ge(r),i({value:void 0,done:!0})},_errorSteps:_=>{this._ongoingPromise=void 0,this._isFinished=!0,ge(r),u(_)}}),c}_returnSteps(r){if(this._isFinished)return Promise.resolve({value:r,done:!0});this._isFinished=!0;let i=this._reader;if(i._ownerReadableStream===void 0)return S(ut("finish iterating"));if(!this._preventCancel){let u=bn(i,r);return ge(i),D(u,()=>({value:r,done:!0}))}return ge(i),w({value:r,done:!0})}}let Hs={next(){return Gs(this)?this._asyncIteratorImpl.next():S(Vs("next"))},return(e){return Gs(this)?this._asyncIteratorImpl.return(e):S(Vs("return"))}};zs!==void 0&&Object.setPrototypeOf(Hs,zs);function dl(e,r){let i=ft(e),u=new js(i,r),c=Object.create(Hs);return c._asyncIteratorImpl=u,c}function Gs(e){if(!l(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof js}catch{return!1}}function Vs(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let Ys=Number.isNaN||function(e){return e!==e};function Wt(e){return e.slice()}function Qs(e,r,i,u,c){new Uint8Array(e).set(new Uint8Array(i,u,c),r)}function vc(e){return e}function gr(e){return!1}function Xs(e,r,i){if(e.slice)return e.slice(r,i);let u=i-r,c=new ArrayBuffer(u);return Qs(c,0,e,r,u),c}function hl(e){return!(typeof e!="number"||Ys(e)||e<0)}function Ks(e){let r=Xs(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(r)}function Pn(e){let r=e._queue.shift();return e._queueTotalSize-=r.size,e._queueTotalSize<0&&(e._queueTotalSize=0),r.value}function vn(e,r,i){if(!hl(i)||i===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:r,size:i}),e._queueTotalSize+=i}function ml(e){return e._queue.peek().value}function Le(e){e._queue=new V,e._queueTotalSize=0}class It{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!An(this))throw On("view");return this._view}respond(r){if(!An(this))throw On("respond");if(we(r,1,"respond"),r=Ms(r,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");gr(this._view.buffer),Er(this._associatedReadableByteStreamController,r)}respondWithNewView(r){if(!An(this))throw On("respondWithNewView");if(we(r,1,"respondWithNewView"),!ArrayBuffer.isView(r))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");gr(r.buffer),Cr(this._associatedReadableByteStreamController,r)}}Object.defineProperties(It.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(It.prototype,t.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class ct{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Qe(this))throw qt("byobRequest");return Bn(this)}get desiredSize(){if(!Qe(this))throw qt("desiredSize");return oo(this)}close(){if(!Qe(this))throw qt("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let r=this._controlledReadableByteStream._state;if(r!=="readable")throw new TypeError(`The stream (in ${r} state) is not in the readable state and cannot be closed`);Ft(this)}enqueue(r){if(!Qe(this))throw qt("enqueue");if(we(r,1,"enqueue"),!ArrayBuffer.isView(r))throw new TypeError("chunk must be an array buffer view");if(r.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(r.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be enqueued to`);Tr(this,r)}error(r=void 0){if(!Qe(this))throw qt("error");ue(this,r)}[Sn](r){Zs(this),Le(this);let i=this._cancelAlgorithm(r);return Rr(this),i}[wn](r){let i=this._controlledReadableByteStream;if(this._queueTotalSize>0){let c=this._queue.shift();this._queueTotalSize-=c.byteLength,ro(this);let p=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);r._chunkSteps(p);return}let u=this._autoAllocateChunkSize;if(u!==void 0){let c;try{c=new ArrayBuffer(u)}catch(_){r._errorSteps(_);return}let p={buffer:c,bufferByteLength:u,byteOffset:0,byteLength:u,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(p)}Us(i,r),Xe(this)}}Object.defineProperties(ct.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(ct.prototype,t.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Qe(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof ct}function An(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof It}function Xe(e){if(!yl(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let i=e._pullAlgorithm();T(i,()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Xe(e))},u=>{ue(e,u)})}function Zs(e){xn(e),e._pendingPullIntos=new V}function kn(e,r){let i=!1;e._state==="closed"&&(i=!0);let u=Js(r);r.readerType==="default"?Cn(e,u,i):wl(e,u,i)}function Js(e){let r=e.bytesFilled,i=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,r/i)}function Sr(e,r,i,u){e._queue.push({buffer:r,byteOffset:i,byteLength:u}),e._queueTotalSize+=u}function eo(e,r){let i=r.elementSize,u=r.bytesFilled-r.bytesFilled%i,c=Math.min(e._queueTotalSize,r.byteLength-r.bytesFilled),p=r.bytesFilled+c,_=p-p%i,R=c,k=!1;_>u&&(R=_-r.bytesFilled,k=!0);let B=e._queue;for(;R>0;){let O=B.peek(),L=Math.min(R,O.byteLength),U=r.byteOffset+r.bytesFilled;Qs(r.buffer,U,O.buffer,O.byteOffset,L),O.byteLength===L?B.shift():(O.byteOffset+=L,O.byteLength-=L),e._queueTotalSize-=L,to(e,L,r),R-=L}return k}function to(e,r,i){i.bytesFilled+=r}function ro(e){e._queueTotalSize===0&&e._closeRequested?(Rr(e),Gt(e._controlledReadableByteStream)):Xe(e)}function xn(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function no(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let r=e._pendingPullIntos.peek();eo(e,r)&&(wr(e),kn(e._controlledReadableByteStream,r))}}function pl(e,r,i){let u=e._controlledReadableByteStream,c=1;r.constructor!==DataView&&(c=r.constructor.BYTES_PER_ELEMENT);let p=r.constructor,_=r.buffer,R={buffer:_,bufferByteLength:_.byteLength,byteOffset:r.byteOffset,byteLength:r.byteLength,bytesFilled:0,elementSize:c,viewConstructor:p,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(R),lo(u,i);return}if(u._state==="closed"){let k=new p(R.buffer,R.byteOffset,0);i._closeSteps(k);return}if(e._queueTotalSize>0){if(eo(e,R)){let k=Js(R);ro(e),i._chunkSteps(k);return}if(e._closeRequested){let k=new TypeError("Insufficient bytes to fill elements in the given buffer");ue(e,k),i._errorSteps(k);return}}e._pendingPullIntos.push(R),lo(u,i),Xe(e)}function _l(e,r){let i=e._controlledReadableByteStream;if(Ln(i))for(;uo(i)>0;){let u=wr(e);kn(i,u)}}function bl(e,r,i){if(to(e,r,i),i.bytesFilled<i.elementSize)return;wr(e);let u=i.bytesFilled%i.elementSize;if(u>0){let c=i.byteOffset+i.bytesFilled,p=Xs(i.buffer,c-u,c);Sr(e,p,0,p.byteLength)}i.bytesFilled-=u,kn(e._controlledReadableByteStream,i),no(e)}function so(e,r){let i=e._pendingPullIntos.peek();xn(e),e._controlledReadableByteStream._state==="closed"?_l(e):bl(e,r,i),Xe(e)}function wr(e){return e._pendingPullIntos.shift()}function yl(e){let r=e._controlledReadableByteStream;return r._state!=="readable"||e._closeRequested||!e._started?!1:!!($s(r)&&br(r)>0||Ln(r)&&uo(r)>0||oo(e)>0)}function Rr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Ft(e){let r=e._controlledReadableByteStream;if(!(e._closeRequested||r._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0&&e._pendingPullIntos.peek().bytesFilled>0){let u=new TypeError("Insufficient bytes to fill elements in the given buffer");throw ue(e,u),u}Rr(e),Gt(r)}}function Tr(e,r){let i=e._controlledReadableByteStream;if(e._closeRequested||i._state!=="readable")return;let u=r.buffer,c=r.byteOffset,p=r.byteLength,_=u;if(e._pendingPullIntos.length>0){let R=e._pendingPullIntos.peek();gr(R.buffer),R.buffer=R.buffer}if(xn(e),$s(i))if(br(i)===0)Sr(e,_,c,p);else{e._pendingPullIntos.length>0&&wr(e);let R=new Uint8Array(_,c,p);Cn(i,R,!1)}else Ln(i)?(Sr(e,_,c,p),no(e)):Sr(e,_,c,p);Xe(e)}function ue(e,r){let i=e._controlledReadableByteStream;i._state==="readable"&&(Zs(e),Le(e),Rr(e),Do(i,r))}function Bn(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let r=e._pendingPullIntos.peek(),i=new Uint8Array(r.buffer,r.byteOffset+r.bytesFilled,r.byteLength-r.bytesFilled),u=Object.create(It.prototype);Sl(u,e,i),e._byobRequest=u}return e._byobRequest}function oo(e){let r=e._controlledReadableByteStream._state;return r==="errored"?null:r==="closed"?0:e._strategyHWM-e._queueTotalSize}function Er(e,r){let i=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(r!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(r===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(i.bytesFilled+r>i.byteLength)throw new RangeError("bytesWritten out of range")}i.buffer=i.buffer,so(e,r)}function Cr(e,r){let i=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(r.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(r.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(i.byteOffset+i.bytesFilled!==r.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(i.bufferByteLength!==r.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(i.bytesFilled+r.byteLength>i.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let c=r.byteLength;i.buffer=r.buffer,so(e,c)}function io(e,r,i,u,c,p,_){r._controlledReadableByteStream=e,r._pullAgain=!1,r._pulling=!1,r._byobRequest=null,r._queue=r._queueTotalSize=void 0,Le(r),r._closeRequested=!1,r._started=!1,r._strategyHWM=p,r._pullAlgorithm=u,r._cancelAlgorithm=c,r._autoAllocateChunkSize=_,r._pendingPullIntos=new V,e._readableStreamController=r;let R=i();T(w(R),()=>{r._started=!0,Xe(r)},k=>{ue(r,k)})}function gl(e,r,i){let u=Object.create(ct.prototype),c=()=>{},p=()=>w(void 0),_=()=>w(void 0);r.start!==void 0&&(c=()=>r.start(u)),r.pull!==void 0&&(p=()=>r.pull(u)),r.cancel!==void 0&&(_=k=>r.cancel(k));let R=r.autoAllocateChunkSize;if(R===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");io(e,u,c,p,_,i,R)}function Sl(e,r,i){e._associatedReadableByteStreamController=r,e._view=i}function On(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function qt(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function ao(e){return new Nt(e)}function lo(e,r){e._reader._readIntoRequests.push(r)}function wl(e,r,i){let c=e._reader._readIntoRequests.shift();i?c._closeSteps(r):c._chunkSteps(r)}function uo(e){return e._reader._readIntoRequests.length}function Ln(e){let r=e._reader;return!(r===void 0||!Ke(r))}class Nt{constructor(r){if(we(r,1,"ReadableStreamBYOBReader"),En(r,"First parameter"),Fe(r))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Qe(r._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");_r(this,r),this._readIntoRequests=new V}get closed(){return Ke(this)?this._closedPromise:S(Pr("closed"))}cancel(r=void 0){return Ke(this)?this._ownerReadableStream===void 0?S(ut("cancel")):bn(this,r):S(Pr("cancel"))}read(r){if(!Ke(this))return S(Pr("read"));if(!ArrayBuffer.isView(r))return S(new TypeError("view must be an array buffer view"));if(r.byteLength===0)return S(new TypeError("view must have non-zero byteLength"));if(r.buffer.byteLength===0)return S(new TypeError("view's buffer must have non-zero byteLength"));if(gr(r.buffer),this._ownerReadableStream===void 0)return S(ut("read from"));let i,u,c=g((_,R)=>{i=_,u=R});return fo(this,r,{_chunkSteps:_=>i({value:_,done:!1}),_closeSteps:_=>i({value:_,done:!0}),_errorSteps:_=>u(_)}),c}releaseLock(){if(!Ke(this))throw Pr("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");ge(this)}}}Object.defineProperties(Nt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Nt.prototype,t.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Ke(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof Nt}function fo(e,r,i){let u=e._ownerReadableStream;u._disturbed=!0,u._state==="errored"?i._errorSteps(u._storedError):pl(u._readableStreamController,r,i)}function Pr(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function Mt(e,r){let{highWaterMark:i}=e;if(i===void 0)return r;if(Ys(i)||i<0)throw new RangeError("Invalid highWaterMark");return i}function vr(e){let{size:r}=e;return r||(()=>1)}function Ar(e,r){Se(e,r);let i=e==null?void 0:e.highWaterMark,u=e==null?void 0:e.size;return{highWaterMark:i===void 0?void 0:Tn(i),size:u===void 0?void 0:Rl(u,`${r} has member 'size' that`)}}function Rl(e,r){return le(e,r),i=>Tn(e(i))}function Tl(e,r){Se(e,r);let i=e==null?void 0:e.abort,u=e==null?void 0:e.close,c=e==null?void 0:e.start,p=e==null?void 0:e.type,_=e==null?void 0:e.write;return{abort:i===void 0?void 0:El(i,e,`${r} has member 'abort' that`),close:u===void 0?void 0:Cl(u,e,`${r} has member 'close' that`),start:c===void 0?void 0:Pl(c,e,`${r} has member 'start' that`),write:_===void 0?void 0:vl(_,e,`${r} has member 'write' that`),type:p}}function El(e,r,i){return le(e,i),u=>I(e,r,[u])}function Cl(e,r,i){return le(e,i),()=>I(e,r,[])}function Pl(e,r,i){return le(e,i),u=>M(e,r,[u])}function vl(e,r,i){return le(e,i),(u,c)=>I(e,r,[u,c])}function co(e,r){if(!dt(e))throw new TypeError(`${r} is not a WritableStream.`)}function Al(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let kl=typeof AbortController=="function";function xl(){if(kl)return new AbortController}class Ut{constructor(r={},i={}){r===void 0?r=null:qs(r,"First parameter");let u=Ar(i,"Second parameter"),c=Tl(r,"First parameter");if(mo(this),c.type!==void 0)throw new RangeError("Invalid type is specified");let _=vr(u),R=Mt(u,1);jl(this,c,R,_)}get locked(){if(!dt(this))throw Lr("locked");return ht(this)}abort(r=void 0){return dt(this)?ht(this)?S(new TypeError("Cannot abort a stream that already has a writer")):kr(this,r):S(Lr("abort"))}close(){return dt(this)?ht(this)?S(new TypeError("Cannot close a stream that already has a writer")):me(this)?S(new TypeError("Cannot close an already-closing stream")):po(this):S(Lr("close"))}getWriter(){if(!dt(this))throw Lr("getWriter");return ho(this)}}Object.defineProperties(Ut.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Ut.prototype,t.toStringTag,{value:"WritableStream",configurable:!0});function ho(e){return new $t(e)}function Bl(e,r,i,u,c=1,p=()=>1){let _=Object.create(Ut.prototype);mo(_);let R=Object.create(mt.prototype);return wo(_,R,e,r,i,u,c,p),_}function mo(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new V,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function dt(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof Ut}function ht(e){return e._writer!==void 0}function kr(e,r){var i;if(e._state==="closed"||e._state==="errored")return w(void 0);e._writableStreamController._abortReason=r,(i=e._writableStreamController._abortController)===null||i===void 0||i.abort();let u=e._state;if(u==="closed"||u==="errored")return w(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let c=!1;u==="erroring"&&(c=!0,r=void 0);let p=g((_,R)=>{e._pendingAbortRequest={_promise:void 0,_resolve:_,_reject:R,_reason:r,_wasAlreadyErroring:c}});return e._pendingAbortRequest._promise=p,c||Wn(e,r),p}function po(e){let r=e._state;if(r==="closed"||r==="errored")return S(new TypeError(`The stream (in ${r} state) is not in the writable state and cannot be closed`));let i=g((c,p)=>{let _={_resolve:c,_reject:p};e._closeRequest=_}),u=e._writer;return u!==void 0&&e._backpressure&&r==="writable"&&jn(u),Hl(e._writableStreamController),i}function Ol(e){return g((i,u)=>{let c={_resolve:i,_reject:u};e._writeRequests.push(c)})}function Dn(e,r){if(e._state==="writable"){Wn(e,r);return}In(e)}function Wn(e,r){let i=e._writableStreamController;e._state="erroring",e._storedError=r;let u=e._writer;u!==void 0&&bo(u,r),!Fl(e)&&i._started&&In(e)}function In(e){e._state="errored",e._writableStreamController[Is]();let r=e._storedError;if(e._writeRequests.forEach(c=>{c._reject(r)}),e._writeRequests=new V,e._pendingAbortRequest===void 0){xr(e);return}let i=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,i._wasAlreadyErroring){i._reject(r),xr(e);return}let u=e._writableStreamController[Ws](i._reason);T(u,()=>{i._resolve(),xr(e)},c=>{i._reject(c),xr(e)})}function Ll(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function Dl(e,r){e._inFlightWriteRequest._reject(r),e._inFlightWriteRequest=void 0,Dn(e,r)}function Wl(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let i=e._writer;i!==void 0&&Co(i)}function Il(e,r){e._inFlightCloseRequest._reject(r),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(r),e._pendingAbortRequest=void 0),Dn(e,r)}function me(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function Fl(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function ql(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Nl(e){e._inFlightWriteRequest=e._writeRequests.shift()}function xr(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let r=e._writer;r!==void 0&&$n(r,e._storedError)}function Fn(e,r){let i=e._writer;i!==void 0&&r!==e._backpressure&&(r?Zl(i):jn(i)),e._backpressure=r}class $t{constructor(r){if(we(r,1,"WritableStreamDefaultWriter"),co(r,"First parameter"),ht(r))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=r,r._writer=this;let i=r._state;if(i==="writable")!me(r)&&r._backpressure?Wr(this):Po(this),Dr(this);else if(i==="erroring")zn(this,r._storedError),Dr(this);else if(i==="closed")Po(this),Xl(this);else{let u=r._storedError;zn(this,u),Eo(this,u)}}get closed(){return Ze(this)?this._closedPromise:S(Je("closed"))}get desiredSize(){if(!Ze(this))throw Je("desiredSize");if(this._ownerWritableStream===void 0)throw zt("desiredSize");return zl(this)}get ready(){return Ze(this)?this._readyPromise:S(Je("ready"))}abort(r=void 0){return Ze(this)?this._ownerWritableStream===void 0?S(zt("abort")):Ml(this,r):S(Je("abort"))}close(){if(!Ze(this))return S(Je("close"));let r=this._ownerWritableStream;return r===void 0?S(zt("close")):me(r)?S(new TypeError("Cannot close an already-closing stream")):_o(this)}releaseLock(){if(!Ze(this))throw Je("releaseLock");this._ownerWritableStream!==void 0&&yo(this)}write(r=void 0){return Ze(this)?this._ownerWritableStream===void 0?S(zt("write to")):go(this,r):S(Je("write"))}}Object.defineProperties($t.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty($t.prototype,t.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Ze(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof $t}function Ml(e,r){let i=e._ownerWritableStream;return kr(i,r)}function _o(e){let r=e._ownerWritableStream;return po(r)}function Ul(e){let r=e._ownerWritableStream,i=r._state;return me(r)||i==="closed"?w(void 0):i==="errored"?S(r._storedError):_o(e)}function $l(e,r){e._closedPromiseState==="pending"?$n(e,r):Kl(e,r)}function bo(e,r){e._readyPromiseState==="pending"?vo(e,r):Jl(e,r)}function zl(e){let r=e._ownerWritableStream,i=r._state;return i==="errored"||i==="erroring"?null:i==="closed"?0:Ro(r._writableStreamController)}function yo(e){let r=e._ownerWritableStream,i=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");bo(e,i),$l(e,i),r._writer=void 0,e._ownerWritableStream=void 0}function go(e,r){let i=e._ownerWritableStream,u=i._writableStreamController,c=Gl(u,r);if(i!==e._ownerWritableStream)return S(zt("write to"));let p=i._state;if(p==="errored")return S(i._storedError);if(me(i)||p==="closed")return S(new TypeError("The stream is closing or closed and cannot be written to"));if(p==="erroring")return S(i._storedError);let _=Ol(i);return Vl(u,r,c),_}let So={};class mt{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!qn(this))throw Un("abortReason");return this._abortReason}get signal(){if(!qn(this))throw Un("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(r=void 0){if(!qn(this))throw Un("error");this._controlledWritableStream._state==="writable"&&To(this,r)}[Ws](r){let i=this._abortAlgorithm(r);return Br(this),i}[Is](){Le(this)}}Object.defineProperties(mt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(mt.prototype,t.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function qn(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof mt}function wo(e,r,i,u,c,p,_,R){r._controlledWritableStream=e,e._writableStreamController=r,r._queue=void 0,r._queueTotalSize=void 0,Le(r),r._abortReason=void 0,r._abortController=xl(),r._started=!1,r._strategySizeAlgorithm=R,r._strategyHWM=_,r._writeAlgorithm=u,r._closeAlgorithm=c,r._abortAlgorithm=p;let k=Mn(r);Fn(e,k);let B=i(),O=w(B);T(O,()=>{r._started=!0,Or(r)},L=>{r._started=!0,Dn(e,L)})}function jl(e,r,i,u){let c=Object.create(mt.prototype),p=()=>{},_=()=>w(void 0),R=()=>w(void 0),k=()=>w(void 0);r.start!==void 0&&(p=()=>r.start(c)),r.write!==void 0&&(_=B=>r.write(B,c)),r.close!==void 0&&(R=()=>r.close()),r.abort!==void 0&&(k=B=>r.abort(B)),wo(e,c,p,_,R,k,i,u)}function Br(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Hl(e){vn(e,So,0),Or(e)}function Gl(e,r){try{return e._strategySizeAlgorithm(r)}catch(i){return Nn(e,i),1}}function Ro(e){return e._strategyHWM-e._queueTotalSize}function Vl(e,r,i){try{vn(e,r,i)}catch(c){Nn(e,c);return}let u=e._controlledWritableStream;if(!me(u)&&u._state==="writable"){let c=Mn(e);Fn(u,c)}Or(e)}function Or(e){let r=e._controlledWritableStream;if(!e._started||r._inFlightWriteRequest!==void 0)return;if(r._state==="erroring"){In(r);return}if(e._queue.length===0)return;let u=ml(e);u===So?Yl(e):Ql(e,u)}function Nn(e,r){e._controlledWritableStream._state==="writable"&&To(e,r)}function Yl(e){let r=e._controlledWritableStream;ql(r),Pn(e);let i=e._closeAlgorithm();Br(e),T(i,()=>{Wl(r)},u=>{Il(r,u)})}function Ql(e,r){let i=e._controlledWritableStream;Nl(i);let u=e._writeAlgorithm(r);T(u,()=>{Ll(i);let c=i._state;if(Pn(e),!me(i)&&c==="writable"){let p=Mn(e);Fn(i,p)}Or(e)},c=>{i._state==="writable"&&Br(e),Dl(i,c)})}function Mn(e){return Ro(e)<=0}function To(e,r){let i=e._controlledWritableStream;Br(e),Wn(i,r)}function Lr(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function Un(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Je(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function zt(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function Dr(e){e._closedPromise=g((r,i)=>{e._closedPromise_resolve=r,e._closedPromise_reject=i,e._closedPromiseState="pending"})}function Eo(e,r){Dr(e),$n(e,r)}function Xl(e){Dr(e),Co(e)}function $n(e,r){e._closedPromise_reject!==void 0&&(N(e._closedPromise),e._closedPromise_reject(r),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function Kl(e,r){Eo(e,r)}function Co(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function Wr(e){e._readyPromise=g((r,i)=>{e._readyPromise_resolve=r,e._readyPromise_reject=i}),e._readyPromiseState="pending"}function zn(e,r){Wr(e),vo(e,r)}function Po(e){Wr(e),jn(e)}function vo(e,r){e._readyPromise_reject!==void 0&&(N(e._readyPromise),e._readyPromise_reject(r),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function Zl(e){Wr(e)}function Jl(e,r){zn(e,r)}function jn(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}let Ao=typeof DOMException<"u"?DOMException:void 0;function eu(e){if(!(typeof e=="function"||typeof e=="object"))return!1;try{return new e,!0}catch{return!1}}function tu(){let e=function(i,u){this.message=i||"",this.name=u||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let ru=eu(Ao)?Ao:tu();function ko(e,r,i,u,c,p){let _=ft(e),R=ho(r);e._disturbed=!0;let k=!1,B=w(void 0);return g((O,L)=>{let U;if(p!==void 0){if(U=()=>{let E=new ru("Aborted","AbortError"),x=[];u||x.push(()=>r._state==="writable"?kr(r,E):w(void 0)),c||x.push(()=>e._state==="readable"?fe(e,E):w(void 0)),Q(()=>Promise.all(x.map(F=>F())),!0,E)},p.aborted){U();return}p.addEventListener("abort",U)}function ce(){return g((E,x)=>{function F(J){J?E():y(bt(),F,x)}F(!1)})}function bt(){return k?w(!0):y(R._readyPromise,()=>g((E,x)=>{Dt(_,{_chunkSteps:F=>{B=y(go(R,F),void 0,n),E(!1)},_closeSteps:()=>E(!0),_errorSteps:x})}))}if(Re(e,_._closedPromise,E=>{u?ne(!0,E):Q(()=>kr(r,E),!0,E)}),Re(r,R._closedPromise,E=>{c?ne(!0,E):Q(()=>fe(e,E),!0,E)}),Y(e,_._closedPromise,()=>{i?ne():Q(()=>Ul(R))}),me(r)||r._state==="closed"){let E=new TypeError("the destination writable stream closed before all data could be piped to it");c?ne(!0,E):Q(()=>fe(e,E),!0,E)}N(ce());function qe(){let E=B;return y(B,()=>E!==B?qe():void 0)}function Re(E,x,F){E._state==="errored"?F(E._storedError):A(x,F)}function Y(E,x,F){E._state==="closed"?F():P(x,F)}function Q(E,x,F){if(k)return;k=!0,r._state==="writable"&&!me(r)?P(qe(),J):J();function J(){T(E(),()=>Te(x,F),yt=>Te(!0,yt))}}function ne(E,x){k||(k=!0,r._state==="writable"&&!me(r)?P(qe(),()=>Te(E,x)):Te(E,x))}function Te(E,x){yo(R),ge(_),p!==void 0&&p.removeEventListener("abort",U),E?L(x):O(void 0)}})}class pt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ir(this))throw Nr("desiredSize");return Hn(this)}close(){if(!Ir(this))throw Nr("close");if(!_t(this))throw new TypeError("The stream is not in a state that permits close");Ht(this)}enqueue(r=void 0){if(!Ir(this))throw Nr("enqueue");if(!_t(this))throw new TypeError("The stream is not in a state that permits enqueue");return qr(this,r)}error(r=void 0){if(!Ir(this))throw Nr("error");De(this,r)}[Sn](r){Le(this);let i=this._cancelAlgorithm(r);return Fr(this),i}[wn](r){let i=this._controlledReadableStream;if(this._queue.length>0){let u=Pn(this);this._closeRequested&&this._queue.length===0?(Fr(this),Gt(i)):jt(this),r._chunkSteps(u)}else Us(i,r),jt(this)}}Object.defineProperties(pt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(pt.prototype,t.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Ir(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof pt}function jt(e){if(!xo(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let i=e._pullAlgorithm();T(i,()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,jt(e))},u=>{De(e,u)})}function xo(e){let r=e._controlledReadableStream;return!_t(e)||!e._started?!1:!!(Fe(r)&&br(r)>0||Hn(e)>0)}function Fr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Ht(e){if(!_t(e))return;let r=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(Fr(e),Gt(r))}function qr(e,r){if(!_t(e))return;let i=e._controlledReadableStream;if(Fe(i)&&br(i)>0)Cn(i,r,!1);else{let u;try{u=e._strategySizeAlgorithm(r)}catch(c){throw De(e,c),c}try{vn(e,r,u)}catch(c){throw De(e,c),c}}jt(e)}function De(e,r){let i=e._controlledReadableStream;i._state==="readable"&&(Le(e),Fr(e),Do(i,r))}function Hn(e){let r=e._controlledReadableStream._state;return r==="errored"?null:r==="closed"?0:e._strategyHWM-e._queueTotalSize}function nu(e){return!xo(e)}function _t(e){let r=e._controlledReadableStream._state;return!e._closeRequested&&r==="readable"}function Bo(e,r,i,u,c,p,_){r._controlledReadableStream=e,r._queue=void 0,r._queueTotalSize=void 0,Le(r),r._started=!1,r._closeRequested=!1,r._pullAgain=!1,r._pulling=!1,r._strategySizeAlgorithm=_,r._strategyHWM=p,r._pullAlgorithm=u,r._cancelAlgorithm=c,e._readableStreamController=r;let R=i();T(w(R),()=>{r._started=!0,jt(r)},k=>{De(r,k)})}function su(e,r,i,u){let c=Object.create(pt.prototype),p=()=>{},_=()=>w(void 0),R=()=>w(void 0);r.start!==void 0&&(p=()=>r.start(c)),r.pull!==void 0&&(_=()=>r.pull(c)),r.cancel!==void 0&&(R=k=>r.cancel(k)),Bo(e,c,p,_,R,i,u)}function Nr(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function ou(e,r){return Qe(e._readableStreamController)?au(e):iu(e)}function iu(e,r){let i=ft(e),u=!1,c=!1,p=!1,_=!1,R,k,B,O,L,U=g(Y=>{L=Y});function ce(){return u?(c=!0,w(void 0)):(u=!0,Dt(i,{_chunkSteps:Q=>{W(()=>{c=!1;let ne=Q,Te=Q;p||qr(B._readableStreamController,ne),_||qr(O._readableStreamController,Te),u=!1,c&&ce()})},_closeSteps:()=>{u=!1,p||Ht(B._readableStreamController),_||Ht(O._readableStreamController),(!p||!_)&&L(void 0)},_errorSteps:()=>{u=!1}}),w(void 0))}function bt(Y){if(p=!0,R=Y,_){let Q=Wt([R,k]),ne=fe(e,Q);L(ne)}return U}function qe(Y){if(_=!0,k=Y,p){let Q=Wt([R,k]),ne=fe(e,Q);L(ne)}return U}function Re(){}return B=Gn(Re,ce,bt),O=Gn(Re,ce,qe),A(i._closedPromise,Y=>{De(B._readableStreamController,Y),De(O._readableStreamController,Y),(!p||!_)&&L(void 0)}),[B,O]}function au(e){let r=ft(e),i=!1,u=!1,c=!1,p=!1,_=!1,R,k,B,O,L,U=g(E=>{L=E});function ce(E){A(E._closedPromise,x=>{E===r&&(ue(B._readableStreamController,x),ue(O._readableStreamController,x),(!p||!_)&&L(void 0))})}function bt(){Ke(r)&&(ge(r),r=ft(e),ce(r)),Dt(r,{_chunkSteps:x=>{W(()=>{u=!1,c=!1;let F=x,J=x;if(!p&&!_)try{J=Ks(x)}catch(yt){ue(B._readableStreamController,yt),ue(O._readableStreamController,yt),L(fe(e,yt));return}p||Tr(B._readableStreamController,F),_||Tr(O._readableStreamController,J),i=!1,u?Re():c&&Y()})},_closeSteps:()=>{i=!1,p||Ft(B._readableStreamController),_||Ft(O._readableStreamController),B._readableStreamController._pendingPullIntos.length>0&&Er(B._readableStreamController,0),O._readableStreamController._pendingPullIntos.length>0&&Er(O._readableStreamController,0),(!p||!_)&&L(void 0)},_errorSteps:()=>{i=!1}})}function qe(E,x){Oe(r)&&(ge(r),r=ao(e),ce(r));let F=x?O:B,J=x?B:O;fo(r,E,{_chunkSteps:gt=>{W(()=>{u=!1,c=!1;let St=x?_:p;if(x?p:_)St||Cr(F._readableStreamController,gt);else{let Vo;try{Vo=Ks(gt)}catch(Yn){ue(F._readableStreamController,Yn),ue(J._readableStreamController,Yn),L(fe(e,Yn));return}St||Cr(F._readableStreamController,gt),Tr(J._readableStreamController,Vo)}i=!1,u?Re():c&&Y()})},_closeSteps:gt=>{i=!1;let St=x?_:p,Yr=x?p:_;St||Ft(F._readableStreamController),Yr||Ft(J._readableStreamController),gt!==void 0&&(St||Cr(F._readableStreamController,gt),!Yr&&J._readableStreamController._pendingPullIntos.length>0&&Er(J._readableStreamController,0)),(!St||!Yr)&&L(void 0)},_errorSteps:()=>{i=!1}})}function Re(){if(i)return u=!0,w(void 0);i=!0;let E=Bn(B._readableStreamController);return E===null?bt():qe(E._view,!1),w(void 0)}function Y(){if(i)return c=!0,w(void 0);i=!0;let E=Bn(O._readableStreamController);return E===null?bt():qe(E._view,!0),w(void 0)}function Q(E){if(p=!0,R=E,_){let x=Wt([R,k]),F=fe(e,x);L(F)}return U}function ne(E){if(_=!0,k=E,p){let x=Wt([R,k]),F=fe(e,x);L(F)}return U}function Te(){}return B=Lo(Te,Re,Q),O=Lo(Te,Y,ne),ce(r),[B,O]}function lu(e,r){Se(e,r);let i=e,u=i==null?void 0:i.autoAllocateChunkSize,c=i==null?void 0:i.cancel,p=i==null?void 0:i.pull,_=i==null?void 0:i.start,R=i==null?void 0:i.type;return{autoAllocateChunkSize:u===void 0?void 0:Ms(u,`${r} has member 'autoAllocateChunkSize' that`),cancel:c===void 0?void 0:uu(c,i,`${r} has member 'cancel' that`),pull:p===void 0?void 0:fu(p,i,`${r} has member 'pull' that`),start:_===void 0?void 0:cu(_,i,`${r} has member 'start' that`),type:R===void 0?void 0:du(R,`${r} has member 'type' that`)}}function uu(e,r,i){return le(e,i),u=>I(e,r,[u])}function fu(e,r,i){return le(e,i),u=>I(e,r,[u])}function cu(e,r,i){return le(e,i),u=>M(e,r,[u])}function du(e,r){if(e=`${e}`,e!=="bytes")throw new TypeError(`${r} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function hu(e,r){Se(e,r);let i=e==null?void 0:e.mode;return{mode:i===void 0?void 0:mu(i,`${r} has member 'mode' that`)}}function mu(e,r){if(e=`${e}`,e!=="byob")throw new TypeError(`${r} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function pu(e,r){Se(e,r);let i=e==null?void 0:e.preventCancel;return{preventCancel:Boolean(i)}}function Oo(e,r){Se(e,r);let i=e==null?void 0:e.preventAbort,u=e==null?void 0:e.preventCancel,c=e==null?void 0:e.preventClose,p=e==null?void 0:e.signal;return p!==void 0&&_u(p,`${r} has member 'signal' that`),{preventAbort:Boolean(i),preventCancel:Boolean(u),preventClose:Boolean(c),signal:p}}function _u(e,r){if(!Al(e))throw new TypeError(`${r} is not an AbortSignal.`)}function bu(e,r){Se(e,r);let i=e==null?void 0:e.readable;Rn(i,"readable","ReadableWritablePair"),En(i,`${r} has member 'readable' that`);let u=e==null?void 0:e.writable;return Rn(u,"writable","ReadableWritablePair"),co(u,`${r} has member 'writable' that`),{readable:i,writable:u}}class We{constructor(r={},i={}){r===void 0?r=null:qs(r,"First parameter");let u=Ar(i,"Second parameter"),c=lu(r,"First parameter");if(Vn(this),c.type==="bytes"){if(u.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let p=Mt(u,0);gl(this,c,p)}else{let p=vr(u),_=Mt(u,1);su(this,c,_,p)}}get locked(){if(!Ie(this))throw et("locked");return Fe(this)}cancel(r=void 0){return Ie(this)?Fe(this)?S(new TypeError("Cannot cancel a stream that already has a reader")):fe(this,r):S(et("cancel"))}getReader(r=void 0){if(!Ie(this))throw et("getReader");return hu(r,"First parameter").mode===void 0?ft(this):ao(this)}pipeThrough(r,i={}){if(!Ie(this))throw et("pipeThrough");we(r,1,"pipeThrough");let u=bu(r,"First parameter"),c=Oo(i,"Second parameter");if(Fe(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(ht(u.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let p=ko(this,u.writable,c.preventClose,c.preventAbort,c.preventCancel,c.signal);return N(p),u.readable}pipeTo(r,i={}){if(!Ie(this))return S(et("pipeTo"));if(r===void 0)return S("Parameter 1 is required in 'pipeTo'.");if(!dt(r))return S(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let u;try{u=Oo(i,"Second parameter")}catch(c){return S(c)}return Fe(this)?S(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):ht(r)?S(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):ko(this,r,u.preventClose,u.preventAbort,u.preventCancel,u.signal)}tee(){if(!Ie(this))throw et("tee");let r=ou(this);return Wt(r)}values(r=void 0){if(!Ie(this))throw et("values");let i=pu(r,"First parameter");return dl(this,i.preventCancel)}}Object.defineProperties(We.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(We.prototype,t.toStringTag,{value:"ReadableStream",configurable:!0}),typeof t.asyncIterator=="symbol"&&Object.defineProperty(We.prototype,t.asyncIterator,{value:We.prototype.values,writable:!0,configurable:!0});function Gn(e,r,i,u=1,c=()=>1){let p=Object.create(We.prototype);Vn(p);let _=Object.create(pt.prototype);return Bo(p,_,e,r,i,u,c),p}function Lo(e,r,i){let u=Object.create(We.prototype);Vn(u);let c=Object.create(ct.prototype);return io(u,c,e,r,i,0,void 0),u}function Vn(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function Ie(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof We}function Fe(e){return e._reader!==void 0}function fe(e,r){if(e._disturbed=!0,e._state==="closed")return w(void 0);if(e._state==="errored")return S(e._storedError);Gt(e);let i=e._reader;i!==void 0&&Ke(i)&&(i._readIntoRequests.forEach(c=>{c._closeSteps(void 0)}),i._readIntoRequests=new V);let u=e._readableStreamController[Sn](r);return D(u,n)}function Gt(e){e._state="closed";let r=e._reader;r!==void 0&&(Ds(r),Oe(r)&&(r._readRequests.forEach(i=>{i._closeSteps()}),r._readRequests=new V))}function Do(e,r){e._state="errored",e._storedError=r;let i=e._reader;i!==void 0&&(gn(i,r),Oe(i)?(i._readRequests.forEach(u=>{u._errorSteps(r)}),i._readRequests=new V):(i._readIntoRequests.forEach(u=>{u._errorSteps(r)}),i._readIntoRequests=new V))}function et(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function Wo(e,r){Se(e,r);let i=e==null?void 0:e.highWaterMark;return Rn(i,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Tn(i)}}let Io=e=>e.byteLength;Object.defineProperty(Io,"name",{value:"size",configurable:!0});class Mr{constructor(r){we(r,1,"ByteLengthQueuingStrategy"),r=Wo(r,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=r.highWaterMark}get highWaterMark(){if(!qo(this))throw Fo("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!qo(this))throw Fo("size");return Io}}Object.defineProperties(Mr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Mr.prototype,t.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Fo(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function qo(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof Mr}let No=()=>1;Object.defineProperty(No,"name",{value:"size",configurable:!0});class Ur{constructor(r){we(r,1,"CountQueuingStrategy"),r=Wo(r,"First parameter"),this._countQueuingStrategyHighWaterMark=r.highWaterMark}get highWaterMark(){if(!Uo(this))throw Mo("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Uo(this))throw Mo("size");return No}}Object.defineProperties(Ur.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Ur.prototype,t.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Mo(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function Uo(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof Ur}function yu(e,r){Se(e,r);let i=e==null?void 0:e.flush,u=e==null?void 0:e.readableType,c=e==null?void 0:e.start,p=e==null?void 0:e.transform,_=e==null?void 0:e.writableType;return{flush:i===void 0?void 0:gu(i,e,`${r} has member 'flush' that`),readableType:u,start:c===void 0?void 0:Su(c,e,`${r} has member 'start' that`),transform:p===void 0?void 0:wu(p,e,`${r} has member 'transform' that`),writableType:_}}function gu(e,r,i){return le(e,i),u=>I(e,r,[u])}function Su(e,r,i){return le(e,i),u=>M(e,r,[u])}function wu(e,r,i){return le(e,i),(u,c)=>I(e,r,[u,c])}class $r{constructor(r={},i={},u={}){r===void 0&&(r=null);let c=Ar(i,"Second parameter"),p=Ar(u,"Third parameter"),_=yu(r,"First parameter");if(_.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(_.writableType!==void 0)throw new RangeError("Invalid writableType specified");let R=Mt(p,0),k=vr(p),B=Mt(c,1),O=vr(c),L,U=g(ce=>{L=ce});Ru(this,U,B,O,R,k),Eu(this,_),_.start!==void 0?L(_.start(this._transformStreamController)):L(void 0)}get readable(){if(!$o(this))throw Go("readable");return this._readable}get writable(){if(!$o(this))throw Go("writable");return this._writable}}Object.defineProperties($r.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty($r.prototype,t.toStringTag,{value:"TransformStream",configurable:!0});function Ru(e,r,i,u,c,p){function _(){return r}function R(U){return vu(e,U)}function k(U){return Au(e,U)}function B(){return ku(e)}e._writable=Bl(_,R,B,k,i,u);function O(){return xu(e)}function L(U){return jr(e,U),w(void 0)}e._readable=Gn(_,O,L,c,p),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Hr(e,!0),e._transformStreamController=void 0}function $o(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof $r}function zr(e,r){De(e._readable._readableStreamController,r),jr(e,r)}function jr(e,r){zo(e._transformStreamController),Nn(e._writable._writableStreamController,r),e._backpressure&&Hr(e,!1)}function Hr(e,r){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=g(i=>{e._backpressureChangePromise_resolve=i}),e._backpressure=r}class Vt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Gr(this))throw Vr("desiredSize");let r=this._controlledTransformStream._readable._readableStreamController;return Hn(r)}enqueue(r=void 0){if(!Gr(this))throw Vr("enqueue");jo(this,r)}error(r=void 0){if(!Gr(this))throw Vr("error");Cu(this,r)}terminate(){if(!Gr(this))throw Vr("terminate");Pu(this)}}Object.defineProperties(Vt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof t.toStringTag=="symbol"&&Object.defineProperty(Vt.prototype,t.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Gr(e){return!l(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof Vt}function Tu(e,r,i,u){r._controlledTransformStream=e,e._transformStreamController=r,r._transformAlgorithm=i,r._flushAlgorithm=u}function Eu(e,r){let i=Object.create(Vt.prototype),u=p=>{try{return jo(i,p),w(void 0)}catch(_){return S(_)}},c=()=>w(void 0);r.transform!==void 0&&(u=p=>r.transform(p,i)),r.flush!==void 0&&(c=()=>r.flush(i)),Tu(e,i,u,c)}function zo(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function jo(e,r){let i=e._controlledTransformStream,u=i._readable._readableStreamController;if(!_t(u))throw new TypeError("Readable side is not in a state that permits enqueue");try{qr(u,r)}catch(p){throw jr(i,p),i._readable._storedError}nu(u)!==i._backpressure&&Hr(i,!0)}function Cu(e,r){zr(e._controlledTransformStream,r)}function Ho(e,r){let i=e._transformAlgorithm(r);return D(i,void 0,u=>{throw zr(e._controlledTransformStream,u),u})}function Pu(e){let r=e._controlledTransformStream,i=r._readable._readableStreamController;Ht(i);let u=new TypeError("TransformStream terminated");jr(r,u)}function vu(e,r){let i=e._transformStreamController;if(e._backpressure){let u=e._backpressureChangePromise;return D(u,()=>{let c=e._writable;if(c._state==="erroring")throw c._storedError;return Ho(i,r)})}return Ho(i,r)}function Au(e,r){return zr(e,r),w(void 0)}function ku(e){let r=e._readable,i=e._transformStreamController,u=i._flushAlgorithm();return zo(i),D(u,()=>{if(r._state==="errored")throw r._storedError;Ht(r._readableStreamController)},c=>{throw zr(e,c),r._storedError})}function xu(e){return Hr(e,!1),e._backpressureChangePromise}function Vr(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function Go(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}s.ByteLengthQueuingStrategy=Mr,s.CountQueuingStrategy=Ur,s.ReadableByteStreamController=ct,s.ReadableStream=We,s.ReadableStreamBYOBReader=Nt,s.ReadableStreamBYOBRequest=It,s.ReadableStreamDefaultController=pt,s.ReadableStreamDefaultReader=Lt,s.TransformStream=$r,s.TransformStreamDefaultController=Vt,s.WritableStream=Ut,s.WritableStreamDefaultController=mt,s.WritableStreamDefaultWriter=$t,Object.defineProperty(s,"__esModule",{value:!0})})});var ni=H(()=>{if(!globalThis.ReadableStream)try{let s=require("node:process"),{emitWarning:t}=s;try{s.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),s.emitWarning=t}catch(n){throw s.emitWarning=t,n}}catch{Object.assign(globalThis,ri())}try{let{Blob:s}=require("buffer");s&&!s.prototype.stream&&(s.prototype.stream=function(n){let o=0,a=this;return new ReadableStream({type:"bytes",async pull(l){let m=await a.slice(o,Math.min(a.size,o+65536)).arrayBuffer();o+=m.byteLength,l.enqueue(new Uint8Array(m)),o===a.size&&l.close()}})})}catch{}});async function*Qn(s,t=!0){for(let n of s)if("stream"in n)yield*n.stream();else if(ArrayBuffer.isView(n))if(t){let o=n.byteOffset,a=n.byteOffset+n.byteLength;for(;o!==a;){let l=Math.min(a-o,si),f=n.buffer.slice(o,o+l);o+=f.byteLength,yield new Uint8Array(f)}}else yield n;else{let o=0;for(;o!==n.size;){let l=await n.slice(o,Math.min(n.size,o+si)).arrayBuffer();o+=l.byteLength,yield new Uint8Array(l)}}}var Oc,si,oi,Mu,rt,Xt=Qt(()=>{Oc=tt(ni(),1);si=65536;oi=class Xn{#e=[];#t="";#r=0;constructor(t=[],n={}){if(typeof t!="object"||t===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof t[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof n!="object"&&typeof n!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");n===null&&(n={});let o=new TextEncoder;for(let l of t){let f;ArrayBuffer.isView(l)?f=new Uint8Array(l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)):l instanceof ArrayBuffer?f=new Uint8Array(l.slice(0)):l instanceof Xn?f=l:f=o.encode(l),this.#r+=ArrayBuffer.isView(f)?f.byteLength:f.size,this.#e.push(f)}let a=n.type===void 0?"":String(n.type);this.#t=/^[\x20-\x7E]*$/.test(a)?a:""}get size(){return this.#r}get type(){return this.#t}async text(){let t=new TextDecoder,n="";for await(let o of Qn(this.#e,!1))n+=t.decode(o,{stream:!0});return n+=t.decode(),n}async arrayBuffer(){let t=new Uint8Array(this.size),n=0;for await(let o of Qn(this.#e,!1))t.set(o,n),n+=o.length;return t.buffer}stream(){let t=Qn(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(n){let o=await t.next();o.done?n.close():n.enqueue(o.value)},async cancel(){await t.return()}})}slice(t=0,n=this.size,o=""){let{size:a}=this,l=t<0?Math.max(a+t,0):Math.min(t,a),f=n<0?Math.max(a+n,0):Math.min(n,a),m=Math.max(f-l,0),d=this.#e,h=[],b=0;for(let w of d){if(b>=m)break;let S=ArrayBuffer.isView(w)?w.byteLength:w.size;if(l&&S<=l)l-=S,f-=S;else{let y;ArrayBuffer.isView(w)?(y=w.subarray(l,Math.min(S,f)),b+=y.byteLength):(y=w.slice(l,Math.min(S,f)),b+=y.size),f-=S,h.push(y),l=0}}let g=new Xn([],{type:String(o).toLowerCase()});return g.#r=m,g.#e=h,g}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](t){return t&&typeof t=="object"&&typeof t.constructor=="function"&&(typeof t.stream=="function"||typeof t.arrayBuffer=="function")&&/^(Blob|File)$/.test(t[Symbol.toStringTag])}};Object.defineProperties(oi.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});Mu=oi,rt=Mu});var Uu,$u,Kt,Kn=Qt(()=>{Xt();Uu=class extends rt{#e=0;#t="";constructor(t,n,o={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(t,o);o===null&&(o={});let a=o.lastModified===void 0?Date.now():Number(o.lastModified);Number.isNaN(a)||(this.#e=a),this.#t=String(n)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}},$u=Uu,Kt=$u});function li(s,t=rt){var n=`${ii()}${ii()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),o=[],a=`--${n}\r
Content-Disposition: form-data; name="`;return s.forEach((l,f)=>typeof l=="string"?o.push(a+Zn(f)+`"\r
\r
${l.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):o.push(a+Zn(f)+`"; filename="${Zn(l.name,1)}"\r
Content-Type: ${l.type||"application/octet-stream"}\r
\r
`,l,`\r
`)),o.push(`--${n}--`),new t(o,{type:"multipart/form-data; boundary="+n})}var Zt,zu,ju,ii,Hu,ai,Zn,nt,wt,Jn=Qt(()=>{Xt();Kn();({toStringTag:Zt,iterator:zu,hasInstance:ju}=Symbol),ii=Math.random,Hu="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),ai=(s,t,n)=>(s+="",/^(Blob|File)$/.test(t&&t[Zt])?[(n=n!==void 0?n+"":t[Zt]=="File"?t.name:"blob",s),t.name!==n||t[Zt]=="blob"?new Kt([t],n,t):t]:[s,t+""]),Zn=(s,t)=>(t?s:s.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),nt=(s,t,n)=>{if(t.length<n)throw new TypeError(`Failed to execute '${s}' on 'FormData': ${n} arguments required, but only ${t.length} present.`)},wt=class{#e=[];constructor(...t){if(t.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Zt](){return"FormData"}[zu](){return this.entries()}static[ju](t){return t&&typeof t=="object"&&t[Zt]==="FormData"&&!Hu.some(n=>typeof t[n]!="function")}append(...t){nt("append",arguments,2),this.#e.push(ai(...t))}delete(t){nt("delete",arguments,1),t+="",this.#e=this.#e.filter(([n])=>n!==t)}get(t){nt("get",arguments,1),t+="";for(var n=this.#e,o=n.length,a=0;a<o;a++)if(n[a][0]===t)return n[a][1];return null}getAll(t,n){return nt("getAll",arguments,1),n=[],t+="",this.#e.forEach(o=>o[0]===t&&n.push(o[1])),n}has(t){return nt("has",arguments,1),t+="",this.#e.some(n=>n[0]===t)}forEach(t,n){nt("forEach",arguments,1);for(var[o,a]of this)t.call(n,a,o,this)}set(...t){nt("set",arguments,2);var n=[],o=!0;t=ai(...t),this.#e.forEach(a=>{a[0]===t[0]?o&&(o=!n.push(t)):n.push(a)}),o&&n.push(t),this.#e=n}*entries(){yield*this.#e}*keys(){for(var[t]of this)yield t}*values(){for(var[,t]of this)yield t}}});var er,fi,Gu,Vu,ts,ci=Qt(()=>{er=require("node:fs"),fi=require("node:worker_threads");Kn();Xt();({stat:Gu}=er.promises),Vu=globalThis.DOMException||(()=>{let s=new fi.MessageChannel().port1,t=new ArrayBuffer(0);try{s.postMessage(t,[t,t])}catch(n){return n.constructor}})(),ts=class{#e;#t;constructor(t){this.#e=t.path,this.#t=t.start,this.size=t.size,this.lastModified=t.lastModified}slice(t,n){return new ts({path:this.#e,lastModified:this.lastModified,size:n-t,start:t})}async*stream(){let{mtimeMs:t}=await Gu(this.#e);if(t>this.lastModified)throw new Vu("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,er.createReadStream)(this.#e,{start:this.#t,end:this.#t+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}});var mi={};Zo(mi,{toFormData:()=>ef});function Ju(s){let t=s.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;let n=t[2]||t[3]||"",o=n.slice(n.lastIndexOf("\\")+1);return o=o.replace(/%22/g,'"'),o=o.replace(/&#(\d{4});/g,(a,l)=>String.fromCharCode(l)),o}async function ef(s,t){if(!/multipart/i.test(t))throw new TypeError("Failed to fetch");let n=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new TypeError("no or bad content-type header, no multipart boundary");let o=new hi(n[1]||n[2]),a,l,f,m,d,h,b=[],g=new wt,w=A=>{f+=P.decode(A,{stream:!0})},S=A=>{b.push(A)},y=()=>{let A=new Kt(b,h,{type:d});g.append(m,A)},T=()=>{g.append(m,f)},P=new TextDecoder("utf-8");P.decode(),o.onPartBegin=function(){o.onPartData=w,o.onPartEnd=T,a="",l="",f="",m="",d="",h=null,b.length=0},o.onHeaderField=function(A){a+=P.decode(A,{stream:!0})},o.onHeaderValue=function(A){l+=P.decode(A,{stream:!0})},o.onHeaderEnd=function(){if(l+=P.decode(),a=a.toLowerCase(),a==="content-disposition"){let A=l.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);A&&(m=A[2]||A[3]||""),h=Ju(l),h&&(o.onPartData=S,o.onPartEnd=y)}else a==="content-type"&&(d=l);l="",a=""};for await(let A of s)o.write(A);return o.end(),g}var pe,q,di,Me,Kr,Zr,Yu,tr,Qu,Xu,Ku,Zu,st,hi,pi=Qt(()=>{ci();Jn();pe=0,q={START_BOUNDARY:pe++,HEADER_FIELD_START:pe++,HEADER_FIELD:pe++,HEADER_VALUE_START:pe++,HEADER_VALUE:pe++,HEADER_VALUE_ALMOST_DONE:pe++,HEADERS_ALMOST_DONE:pe++,PART_DATA_START:pe++,PART_DATA:pe++,END:pe++},di=1,Me={PART_BOUNDARY:di,LAST_BOUNDARY:di*=2},Kr=10,Zr=13,Yu=32,tr=45,Qu=58,Xu=97,Ku=122,Zu=s=>s|32,st=()=>{},hi=class{constructor(t){this.index=0,this.flags=0,this.onHeaderEnd=st,this.onHeaderField=st,this.onHeadersEnd=st,this.onHeaderValue=st,this.onPartBegin=st,this.onPartData=st,this.onPartEnd=st,this.boundaryChars={},t=`\r
--`+t;let n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o),this.boundaryChars[n[o]]=!0;this.boundary=n,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=q.START_BOUNDARY}write(t){let n=0,o=t.length,a=this.index,{lookbehind:l,boundary:f,boundaryChars:m,index:d,state:h,flags:b}=this,g=this.boundary.length,w=g-1,S=t.length,y,T,P=W=>{this[W+"Mark"]=n},A=W=>{delete this[W+"Mark"]},D=(W,M,I,ae)=>{(M===void 0||M!==I)&&this[W](ae&&ae.subarray(M,I))},N=(W,M)=>{let I=W+"Mark";I in this&&(M?(D(W,this[I],n,t),delete this[I]):(D(W,this[I],t.length,t),this[I]=0))};for(n=0;n<o;n++)switch(y=t[n],h){case q.START_BOUNDARY:if(d===f.length-2){if(y===tr)b|=Me.LAST_BOUNDARY;else if(y!==Zr)return;d++;break}else if(d-1===f.length-2){if(b&Me.LAST_BOUNDARY&&y===tr)h=q.END,b=0;else if(!(b&Me.LAST_BOUNDARY)&&y===Kr)d=0,D("onPartBegin"),h=q.HEADER_FIELD_START;else return;break}y!==f[d+2]&&(d=-2),y===f[d+2]&&d++;break;case q.HEADER_FIELD_START:h=q.HEADER_FIELD,P("onHeaderField"),d=0;case q.HEADER_FIELD:if(y===Zr){A("onHeaderField"),h=q.HEADERS_ALMOST_DONE;break}if(d++,y===tr)break;if(y===Qu){if(d===1)return;N("onHeaderField",!0),h=q.HEADER_VALUE_START;break}if(T=Zu(y),T<Xu||T>Ku)return;break;case q.HEADER_VALUE_START:if(y===Yu)break;P("onHeaderValue"),h=q.HEADER_VALUE;case q.HEADER_VALUE:y===Zr&&(N("onHeaderValue",!0),D("onHeaderEnd"),h=q.HEADER_VALUE_ALMOST_DONE);break;case q.HEADER_VALUE_ALMOST_DONE:if(y!==Kr)return;h=q.HEADER_FIELD_START;break;case q.HEADERS_ALMOST_DONE:if(y!==Kr)return;D("onHeadersEnd"),h=q.PART_DATA_START;break;case q.PART_DATA_START:h=q.PART_DATA,P("onPartData");case q.PART_DATA:if(a=d,d===0){for(n+=w;n<S&&!(t[n]in m);)n+=g;n-=w,y=t[n]}if(d<f.length)f[d]===y?(d===0&&N("onPartData",!0),d++):d=0;else if(d===f.length)d++,y===Zr?b|=Me.PART_BOUNDARY:y===tr?b|=Me.LAST_BOUNDARY:d=0;else if(d-1===f.length)if(b&Me.PART_BOUNDARY){if(d=0,y===Kr){b&=~Me.PART_BOUNDARY,D("onPartEnd"),D("onPartBegin"),h=q.HEADER_FIELD_START;break}}else b&Me.LAST_BOUNDARY&&y===tr?(D("onPartEnd"),h=q.END,b=0):d=0;if(d>0)l[d-1]=y;else if(a>0){let W=new Uint8Array(l.buffer,l.byteOffset,l.byteLength);D("onPartData",0,a,W),a=0,P("onPartData"),n--}break;case q.END:break;default:throw new Error(`Unexpected state entered: ${h}`)}N("onHeaderField"),N("onHeaderValue"),N("onPartData"),this.index=d,this.state=h,this.flags=b}end(){if(this.state===q.HEADER_FIELD_START&&this.index===0||this.state===q.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==q.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var je=H((Id,qi)=>{"use strict";qi.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var ir=H((Fd,fs)=>{"use strict";var{EMPTY_BUFFER:df}=je();function Ni(s,t){if(s.length===0)return df;if(s.length===1)return s[0];let n=Buffer.allocUnsafe(t),o=0;for(let a=0;a<s.length;a++){let l=s[a];n.set(l,o),o+=l.length}return o<t?n.slice(0,o):n}function Mi(s,t,n,o,a){for(let l=0;l<a;l++)n[o+l]=s[l]^t[l&3]}function Ui(s,t){for(let n=0;n<s.length;n++)s[n]^=t[n&3]}function $i(s){return s.byteLength===s.buffer.byteLength?s.buffer:s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}function on(s){if(on.readOnly=!0,Buffer.isBuffer(s))return s;let t;return s instanceof ArrayBuffer?t=Buffer.from(s):ArrayBuffer.isView(s)?t=Buffer.from(s.buffer,s.byteOffset,s.byteLength):(t=Buffer.from(s),on.readOnly=!1),t}try{let s=require("bufferutil");fs.exports={concat:Ni,mask(t,n,o,a,l){l<48?Mi(t,n,o,a,l):s.mask(t,n,o,a,l)},toArrayBuffer:$i,toBuffer:on,unmask(t,n){t.length<32?Ui(t,n):s.unmask(t,n)}}}catch{fs.exports={concat:Ni,mask:Mi,toArrayBuffer:$i,toBuffer:on,unmask:Ui}}});var Gi=H((qd,Hi)=>{"use strict";var zi=Symbol("kDone"),cs=Symbol("kRun"),ji=class{constructor(t){this[zi]=()=>{this.pending--,this[cs]()},this.concurrency=t||1/0,this.jobs=[],this.pending=0}add(t){this.jobs.push(t),this[cs]()}[cs](){if(this.pending!==this.concurrency&&this.jobs.length){let t=this.jobs.shift();this.pending++,t(this[zi])}}};Hi.exports=ji});var ur=H((Nd,Ki)=>{"use strict";var ar=require("zlib"),Vi=ir(),hf=Gi(),{kStatusCode:Yi}=je(),mf=Buffer.from([0,0,255,255]),un=Symbol("permessage-deflate"),Pe=Symbol("total-length"),lr=Symbol("callback"),He=Symbol("buffers"),ln=Symbol("error"),an,Qi=class{constructor(t,n,o){if(this._maxPayload=o|0,this._options=t||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!n,this._deflate=null,this._inflate=null,this.params=null,!an){let a=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;an=new hf(a)}}static get extensionName(){return"permessage-deflate"}offer(){let t={};return this._options.serverNoContextTakeover&&(t.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(t.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(t.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?t.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(t.client_max_window_bits=!0),t}accept(t){return t=this.normalizeParams(t),this.params=this._isServer?this.acceptAsServer(t):this.acceptAsClient(t),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let t=this._deflate[lr];this._deflate.close(),this._deflate=null,t&&t(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(t){let n=this._options,o=t.find(a=>!(n.serverNoContextTakeover===!1&&a.server_no_context_takeover||a.server_max_window_bits&&(n.serverMaxWindowBits===!1||typeof n.serverMaxWindowBits=="number"&&n.serverMaxWindowBits>a.server_max_window_bits)||typeof n.clientMaxWindowBits=="number"&&!a.client_max_window_bits));if(!o)throw new Error("None of the extension offers can be accepted");return n.serverNoContextTakeover&&(o.server_no_context_takeover=!0),n.clientNoContextTakeover&&(o.client_no_context_takeover=!0),typeof n.serverMaxWindowBits=="number"&&(o.server_max_window_bits=n.serverMaxWindowBits),typeof n.clientMaxWindowBits=="number"?o.client_max_window_bits=n.clientMaxWindowBits:(o.client_max_window_bits===!0||n.clientMaxWindowBits===!1)&&delete o.client_max_window_bits,o}acceptAsClient(t){let n=t[0];if(this._options.clientNoContextTakeover===!1&&n.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!n.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(n.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&n.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return n}normalizeParams(t){return t.forEach(n=>{Object.keys(n).forEach(o=>{let a=n[o];if(a.length>1)throw new Error(`Parameter "${o}" must have only a single value`);if(a=a[0],o==="client_max_window_bits"){if(a!==!0){let l=+a;if(!Number.isInteger(l)||l<8||l>15)throw new TypeError(`Invalid value for parameter "${o}": ${a}`);a=l}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${o}": ${a}`)}else if(o==="server_max_window_bits"){let l=+a;if(!Number.isInteger(l)||l<8||l>15)throw new TypeError(`Invalid value for parameter "${o}": ${a}`);a=l}else if(o==="client_no_context_takeover"||o==="server_no_context_takeover"){if(a!==!0)throw new TypeError(`Invalid value for parameter "${o}": ${a}`)}else throw new Error(`Unknown parameter "${o}"`);n[o]=a})}),t}decompress(t,n,o){an.add(a=>{this._decompress(t,n,(l,f)=>{a(),o(l,f)})})}compress(t,n,o){an.add(a=>{this._compress(t,n,(l,f)=>{a(),o(l,f)})})}_decompress(t,n,o){let a=this._isServer?"client":"server";if(!this._inflate){let l=`${a}_max_window_bits`,f=typeof this.params[l]!="number"?ar.Z_DEFAULT_WINDOWBITS:this.params[l];this._inflate=ar.createInflateRaw(Ee(X({},this._options.zlibInflateOptions),{windowBits:f})),this._inflate[un]=this,this._inflate[Pe]=0,this._inflate[He]=[],this._inflate.on("error",_f),this._inflate.on("data",Xi)}this._inflate[lr]=o,this._inflate.write(t),n&&this._inflate.write(mf),this._inflate.flush(()=>{let l=this._inflate[ln];if(l){this._inflate.close(),this._inflate=null,o(l);return}let f=Vi.concat(this._inflate[He],this._inflate[Pe]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Pe]=0,this._inflate[He]=[],n&&this.params[`${a}_no_context_takeover`]&&this._inflate.reset()),o(null,f)})}_compress(t,n,o){let a=this._isServer?"server":"client";if(!this._deflate){let l=`${a}_max_window_bits`,f=typeof this.params[l]!="number"?ar.Z_DEFAULT_WINDOWBITS:this.params[l];this._deflate=ar.createDeflateRaw(Ee(X({},this._options.zlibDeflateOptions),{windowBits:f})),this._deflate[Pe]=0,this._deflate[He]=[],this._deflate.on("data",pf)}this._deflate[lr]=o,this._deflate.write(t),this._deflate.flush(ar.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let l=Vi.concat(this._deflate[He],this._deflate[Pe]);n&&(l=l.slice(0,l.length-4)),this._deflate[lr]=null,this._deflate[Pe]=0,this._deflate[He]=[],n&&this.params[`${a}_no_context_takeover`]&&this._deflate.reset(),o(null,l)})}};Ki.exports=Qi;function pf(s){this[He].push(s),this[Pe]+=s.length}function Xi(s){if(this[Pe]+=s.length,this[un]._maxPayload<1||this[Pe]<=this[un]._maxPayload){this[He].push(s);return}this[ln]=new RangeError("Max payload size exceeded"),this[ln].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[ln][Yi]=1009,this.removeListener("data",Xi),this.reset()}function _f(s){this[un]._inflate=null,s[Yi]=1007,this[lr](s)}});var fr=H((Md,ds)=>{"use strict";var Zi=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Ji(s){return s>=1e3&&s<=1014&&s!==1004&&s!==1005&&s!==1006||s>=3e3&&s<=4999}function ea(s){let t=s.length,n=0;for(;n<t;)if((s[n]&128)===0)n++;else if((s[n]&224)===192){if(n+1===t||(s[n+1]&192)!==128||(s[n]&254)===192)return!1;n+=2}else if((s[n]&240)===224){if(n+2>=t||(s[n+1]&192)!==128||(s[n+2]&192)!==128||s[n]===224&&(s[n+1]&224)===128||s[n]===237&&(s[n+1]&224)===160)return!1;n+=3}else if((s[n]&248)===240){if(n+3>=t||(s[n+1]&192)!==128||(s[n+2]&192)!==128||(s[n+3]&192)!==128||s[n]===240&&(s[n+1]&240)===128||s[n]===244&&s[n+1]>143||s[n]>244)return!1;n+=4}else return!1;return!0}try{let s=require("utf-8-validate");ds.exports={isValidStatusCode:Ji,isValidUTF8(t){return t.length<150?ea(t):s(t)},tokenChars:Zi}}catch{ds.exports={isValidStatusCode:Ji,isValidUTF8:ea,tokenChars:Zi}}});var ps=H((Ud,la)=>{"use strict";var{Writable:bf}=require("stream"),ta=ur(),{BINARY_TYPES:yf,EMPTY_BUFFER:ra,kStatusCode:gf,kWebSocket:Sf}=je(),{concat:hs,toArrayBuffer:wf,unmask:Rf}=ir(),{isValidStatusCode:Tf,isValidUTF8:na}=fr(),cr=0,sa=1,oa=2,ia=3,ms=4,Ef=5,aa=class extends bf{constructor(t={}){super();this._binaryType=t.binaryType||yf[0],this._extensions=t.extensions||{},this._isServer=!!t.isServer,this._maxPayload=t.maxPayload|0,this._skipUTF8Validation=!!t.skipUTF8Validation,this[Sf]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=cr,this._loop=!1}_write(t,n,o){if(this._opcode===8&&this._state==cr)return o();this._bufferedBytes+=t.length,this._buffers.push(t),this.startLoop(o)}consume(t){if(this._bufferedBytes-=t,t===this._buffers[0].length)return this._buffers.shift();if(t<this._buffers[0].length){let o=this._buffers[0];return this._buffers[0]=o.slice(t),o.slice(0,t)}let n=Buffer.allocUnsafe(t);do{let o=this._buffers[0],a=n.length-t;t>=o.length?n.set(this._buffers.shift(),a):(n.set(new Uint8Array(o.buffer,o.byteOffset,t),a),this._buffers[0]=o.slice(t)),t-=o.length}while(t>0);return n}startLoop(t){let n;this._loop=!0;do switch(this._state){case cr:n=this.getInfo();break;case sa:n=this.getPayloadLength16();break;case oa:n=this.getPayloadLength64();break;case ia:this.getMask();break;case ms:n=this.getData(t);break;default:this._loop=!1;return}while(this._loop);t(n)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0)return this._loop=!1,$(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let n=(t[0]&64)===64;if(n&&!this._extensions[ta.extensionName])return this._loop=!1,$(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(n)return this._loop=!1,$(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,$(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,$(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,$(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(n)return this._loop=!1,$(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,$(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,$(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,$(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,$(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=sa;else if(this._payloadLength===127)this._state=oa;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),n=t.readUInt32BE(0);return n>Math.pow(2,53-32)-1?(this._loop=!1,$(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=n*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,$(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=ia:this._state=ms}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=ms}getData(t){let n=ra;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}n=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&Rf(n,this._mask)}if(this._opcode>7)return this.controlMessage(n);if(this._compressed){this._state=Ef,this.decompress(n,t);return}return n.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(n)),this.dataMessage()}decompress(t,n){this._extensions[ta.extensionName].decompress(t,this._fin,(a,l)=>{if(a)return n(a);if(l.length){if(this._messageLength+=l.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return n($(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(l)}let f=this.dataMessage();if(f)return n(f);this.startLoop(n)})}dataMessage(){if(this._fin){let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=hs(n,t):this._binaryType==="arraybuffer"?o=wf(hs(n,t)):o=n,this.emit("message",o,!0)}else{let o=hs(n,t);if(!this._skipUTF8Validation&&!na(o))return this._loop=!1,$(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",o,!1)}}this._state=cr}controlMessage(t){if(this._opcode===8)if(this._loop=!1,t.length===0)this.emit("conclude",1005,ra),this.end();else{if(t.length===1)return $(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{let n=t.readUInt16BE(0);if(!Tf(n))return $(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let o=t.slice(2);if(!this._skipUTF8Validation&&!na(o))return $(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",n,o),this.end()}}else this._opcode===9?this.emit("ping",t):this.emit("pong",t);this._state=cr}};la.exports=aa;function $(s,t,n,o,a){let l=new s(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(l,$),l.code=a,l[gf]=o,l}});var _s=H((jd,ca)=>{"use strict";var $d=require("net"),zd=require("tls"),{randomFillSync:Cf}=require("crypto"),ua=ur(),{EMPTY_BUFFER:Pf}=je(),{isValidStatusCode:vf}=fr(),{mask:fa,toBuffer:ve}=ir(),Af=Buffer.alloc(4),Ae=class{constructor(t,n,o){this._extensions=n||{},o&&(this._generateMask=o,this._maskBuffer=Buffer.alloc(4)),this._socket=t,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(t,n){let o,a=!1,l=2,f=!1;n.mask&&(o=n.maskBuffer||Af,n.generateMask?n.generateMask(o):Cf(o,0,4),f=(o[0]|o[1]|o[2]|o[3])===0,n.readOnly&&!f&&(a=!0),l=6);let m=t.length;t.length>=65536?(l+=8,m=127):t.length>125&&(l+=2,m=126);let d=Buffer.allocUnsafe(a?t.length+l:l);return d[0]=n.fin?n.opcode|128:n.opcode,n.rsv1&&(d[0]|=64),d[1]=m,m===126?d.writeUInt16BE(t.length,2):m===127&&(d[2]=d[3]=0,d.writeUIntBE(t.length,4,6)),n.mask?(d[1]|=128,d[l-4]=o[0],d[l-3]=o[1],d[l-2]=o[2],d[l-1]=o[3],f?[d,t]:a?(fa(t,o,d,l,t.length),[d]):(fa(t,o,t,0,t.length),[d,t])):[d,t]}close(t,n,o,a){let l;if(t===void 0)l=Pf;else{if(typeof t!="number"||!vf(t))throw new TypeError("First argument must be a valid error code number");if(n===void 0||!n.length)l=Buffer.allocUnsafe(2),l.writeUInt16BE(t,0);else{let f=Buffer.byteLength(n);if(f>123)throw new RangeError("The message must not be greater than 123 bytes");l=Buffer.allocUnsafe(2+f),l.writeUInt16BE(t,0),typeof n=="string"?l.write(n,2):l.set(n,2)}}this._deflating?this.enqueue([this.doClose,l,o,a]):this.doClose(l,o,a)}doClose(t,n,o){this.sendFrame(Ae.frame(t,{fin:!0,rsv1:!1,opcode:8,mask:n,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:!1}),o)}ping(t,n,o){let a=ve(t);if(a.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,a,n,ve.readOnly,o]):this.doPing(a,n,ve.readOnly,o)}doPing(t,n,o,a){this.sendFrame(Ae.frame(t,{fin:!0,rsv1:!1,opcode:9,mask:n,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:o}),a)}pong(t,n,o){let a=ve(t);if(a.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,a,n,ve.readOnly,o]):this.doPong(a,n,ve.readOnly,o)}doPong(t,n,o,a){this.sendFrame(Ae.frame(t,{fin:!0,rsv1:!1,opcode:10,mask:n,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:o}),a)}send(t,n,o){let a=ve(t),l=this._extensions[ua.extensionName],f=n.binary?2:1,m=n.compress;if(this._firstFragment?(this._firstFragment=!1,m&&l&&l.params[l._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(m=a.length>=l._threshold),this._compress=m):(m=!1,f=0),n.fin&&(this._firstFragment=!0),l){let d={fin:n.fin,rsv1:m,opcode:f,mask:n.mask,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:ve.readOnly};this._deflating?this.enqueue([this.dispatch,a,this._compress,d,o]):this.dispatch(a,this._compress,d,o)}else this.sendFrame(Ae.frame(a,{fin:n.fin,rsv1:!1,opcode:f,mask:n.mask,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:ve.readOnly}),o)}dispatch(t,n,o,a){if(!n){this.sendFrame(Ae.frame(t,o),a);return}let l=this._extensions[ua.extensionName];this._bufferedBytes+=t.length,this._deflating=!0,l.compress(t,o.fin,(f,m)=>{if(this._socket.destroyed){let d=new Error("The socket was closed while data was being compressed");typeof a=="function"&&a(d);for(let h=0;h<this._queue.length;h++){let b=this._queue[h][4];typeof b=="function"&&b(d)}return}this._bufferedBytes-=t.length,this._deflating=!1,o.readOnly=!1,this.sendFrame(Ae.frame(m,o),a),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let t=this._queue.shift();this._bufferedBytes-=t[1].length,Reflect.apply(t[0],this,t.slice(1))}}enqueue(t){this._bufferedBytes+=t[1].length,this._queue.push(t)}sendFrame(t,n){t.length===2?(this._socket.cork(),this._socket.write(t[0]),this._socket.write(t[1],n),this._socket.uncork()):this._socket.write(t[0],n)}};ca.exports=Ae});var wa=H((Hd,Sa)=>{"use strict";var{kForOnEventAttribute:bs,kListener:da}=je(),ha=Symbol("kCode"),ma=Symbol("kData"),pa=Symbol("kError"),_a=Symbol("kMessage"),ba=Symbol("kReason"),At=Symbol("kTarget"),ya=Symbol("kType"),ga=Symbol("kWasClean"),Ge=class{constructor(t){this[At]=null,this[ya]=t}get target(){return this[At]}get type(){return this[ya]}};Object.defineProperty(Ge.prototype,"target",{enumerable:!0});Object.defineProperty(Ge.prototype,"type",{enumerable:!0});var kt=class extends Ge{constructor(t,n={}){super(t);this[ha]=n.code===void 0?0:n.code,this[ba]=n.reason===void 0?"":n.reason,this[ga]=n.wasClean===void 0?!1:n.wasClean}get code(){return this[ha]}get reason(){return this[ba]}get wasClean(){return this[ga]}};Object.defineProperty(kt.prototype,"code",{enumerable:!0});Object.defineProperty(kt.prototype,"reason",{enumerable:!0});Object.defineProperty(kt.prototype,"wasClean",{enumerable:!0});var dr=class extends Ge{constructor(t,n={}){super(t);this[pa]=n.error===void 0?null:n.error,this[_a]=n.message===void 0?"":n.message}get error(){return this[pa]}get message(){return this[_a]}};Object.defineProperty(dr.prototype,"error",{enumerable:!0});Object.defineProperty(dr.prototype,"message",{enumerable:!0});var fn=class extends Ge{constructor(t,n={}){super(t);this[ma]=n.data===void 0?null:n.data}get data(){return this[ma]}};Object.defineProperty(fn.prototype,"data",{enumerable:!0});var kf={addEventListener(s,t,n={}){let o;if(s==="message")o=function(l,f){let m=new fn("message",{data:f?l:l.toString()});m[At]=this,t.call(this,m)};else if(s==="close")o=function(l,f){let m=new kt("close",{code:l,reason:f.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});m[At]=this,t.call(this,m)};else if(s==="error")o=function(l){let f=new dr("error",{error:l,message:l.message});f[At]=this,t.call(this,f)};else if(s==="open")o=function(){let l=new Ge("open");l[At]=this,t.call(this,l)};else return;o[bs]=!!n[bs],o[da]=t,n.once?this.once(s,o):this.on(s,o)},removeEventListener(s,t){for(let n of this.listeners(s))if(n[da]===t&&!n[bs]){this.removeListener(s,n);break}}};Sa.exports={CloseEvent:kt,ErrorEvent:dr,Event:Ge,EventTarget:kf,MessageEvent:fn}});var ys=H((Gd,Ra)=>{"use strict";var{tokenChars:hr}=fr();function be(s,t,n){s[t]===void 0?s[t]=[n]:s[t].push(n)}function xf(s){let t=Object.create(null),n=Object.create(null),o=!1,a=!1,l=!1,f,m,d=-1,h=-1,b=-1,g=0;for(;g<s.length;g++)if(h=s.charCodeAt(g),f===void 0)if(b===-1&&hr[h]===1)d===-1&&(d=g);else if(g!==0&&(h===32||h===9))b===-1&&d!==-1&&(b=g);else if(h===59||h===44){if(d===-1)throw new SyntaxError(`Unexpected character at index ${g}`);b===-1&&(b=g);let S=s.slice(d,b);h===44?(be(t,S,n),n=Object.create(null)):f=S,d=b=-1}else throw new SyntaxError(`Unexpected character at index ${g}`);else if(m===void 0)if(b===-1&&hr[h]===1)d===-1&&(d=g);else if(h===32||h===9)b===-1&&d!==-1&&(b=g);else if(h===59||h===44){if(d===-1)throw new SyntaxError(`Unexpected character at index ${g}`);b===-1&&(b=g),be(n,s.slice(d,b),!0),h===44&&(be(t,f,n),n=Object.create(null),f=void 0),d=b=-1}else if(h===61&&d!==-1&&b===-1)m=s.slice(d,g),d=b=-1;else throw new SyntaxError(`Unexpected character at index ${g}`);else if(a){if(hr[h]!==1)throw new SyntaxError(`Unexpected character at index ${g}`);d===-1?d=g:o||(o=!0),a=!1}else if(l)if(hr[h]===1)d===-1&&(d=g);else if(h===34&&d!==-1)l=!1,b=g;else if(h===92)a=!0;else throw new SyntaxError(`Unexpected character at index ${g}`);else if(h===34&&s.charCodeAt(g-1)===61)l=!0;else if(b===-1&&hr[h]===1)d===-1&&(d=g);else if(d!==-1&&(h===32||h===9))b===-1&&(b=g);else if(h===59||h===44){if(d===-1)throw new SyntaxError(`Unexpected character at index ${g}`);b===-1&&(b=g);let S=s.slice(d,b);o&&(S=S.replace(/\\/g,""),o=!1),be(n,m,S),h===44&&(be(t,f,n),n=Object.create(null),f=void 0),m=void 0,d=b=-1}else throw new SyntaxError(`Unexpected character at index ${g}`);if(d===-1||l||h===32||h===9)throw new SyntaxError("Unexpected end of input");b===-1&&(b=g);let w=s.slice(d,b);return f===void 0?be(t,w,n):(m===void 0?be(n,w,!0):o?be(n,m,w.replace(/\\/g,"")):be(n,m,w),be(t,f,n)),t}function Bf(s){return Object.keys(s).map(t=>{let n=s[t];return Array.isArray(n)||(n=[n]),n.map(o=>[t].concat(Object.keys(o).map(a=>{let l=o[a];return Array.isArray(l)||(l=[l]),l.map(f=>f===!0?a:`${a}=${f}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Ra.exports={format:Bf,parse:xf}});var Es=H((Yd,Oa)=>{"use strict";var Of=require("events"),Lf=require("https"),Df=require("http"),Ca=require("net"),Wf=require("tls"),{randomBytes:If,createHash:Ff}=require("crypto"),{Readable:Vd}=require("stream"),{URL:gs}=require("url"),Ve=ur(),qf=ps(),Nf=_s(),{BINARY_TYPES:Ta,EMPTY_BUFFER:cn,GUID:Mf,kForOnEventAttribute:Ss,kListener:Uf,kStatusCode:$f,kWebSocket:G,NOOP:Pa}=je(),{EventTarget:{addEventListener:zf,removeEventListener:jf}}=wa(),{format:Hf,parse:Gf}=ys(),{toBuffer:Vf}=ir(),ke=["CONNECTING","OPEN","CLOSING","CLOSED"],Yf=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,ws=[8,13],Qf=30*1e3,v=class extends Of{constructor(t,n,o){super();this._binaryType=Ta[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=cn,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=v.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,t!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,n===void 0?n=[]:Array.isArray(n)||(typeof n=="object"&&n!==null?(o=n,n=[]):n=[n]),va(this,t,n,o)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(t){!Ta.includes(t)||(this._binaryType=t,this._receiver&&(this._receiver._binaryType=t))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(t,n,o){let a=new qf({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation});this._sender=new Nf(t,this._extensions,o.generateMask),this._receiver=a,this._socket=t,a[G]=this,t[G]=this,a.on("conclude",Zf),a.on("drain",Jf),a.on("error",ec),a.on("message",tc),a.on("ping",rc),a.on("pong",nc),t.setTimeout(0),t.setNoDelay(),n.length>0&&t.unshift(n),t.on("close",ka),t.on("data",dn),t.on("end",xa),t.on("error",Ba),this._readyState=v.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=v.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Ve.extensionName]&&this._extensions[Ve.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=v.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(t,n){if(this.readyState!==v.CLOSED){if(this.readyState===v.CONNECTING){let o="WebSocket was closed before the connection was established";return oe(this,this._req,o)}if(this.readyState===v.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=v.CLOSING,this._sender.close(t,n,!this._isServer,o=>{o||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Qf)}}pause(){this.readyState===v.CONNECTING||this.readyState===v.CLOSED||(this._paused=!0,this._socket.pause())}ping(t,n,o){if(this.readyState===v.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(o=t,t=n=void 0):typeof n=="function"&&(o=n,n=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==v.OPEN){Ts(this,t,o);return}n===void 0&&(n=!this._isServer),this._sender.ping(t||cn,n,o)}pong(t,n,o){if(this.readyState===v.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"?(o=t,t=n=void 0):typeof n=="function"&&(o=n,n=void 0),typeof t=="number"&&(t=t.toString()),this.readyState!==v.OPEN){Ts(this,t,o);return}n===void 0&&(n=!this._isServer),this._sender.pong(t||cn,n,o)}resume(){this.readyState===v.CONNECTING||this.readyState===v.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(t,n,o){if(this.readyState===v.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof n=="function"&&(o=n,n={}),typeof t=="number"&&(t=t.toString()),this.readyState!==v.OPEN){Ts(this,t,o);return}let a=X({binary:typeof t!="string",mask:!this._isServer,compress:!0,fin:!0},n);this._extensions[Ve.extensionName]||(a.compress=!1),this._sender.send(t||cn,a,o)}terminate(){if(this.readyState!==v.CLOSED){if(this.readyState===v.CONNECTING){let t="WebSocket was closed before the connection was established";return oe(this,this._req,t)}this._socket&&(this._readyState=v.CLOSING,this._socket.destroy())}}};Object.defineProperty(v,"CONNECTING",{enumerable:!0,value:ke.indexOf("CONNECTING")});Object.defineProperty(v.prototype,"CONNECTING",{enumerable:!0,value:ke.indexOf("CONNECTING")});Object.defineProperty(v,"OPEN",{enumerable:!0,value:ke.indexOf("OPEN")});Object.defineProperty(v.prototype,"OPEN",{enumerable:!0,value:ke.indexOf("OPEN")});Object.defineProperty(v,"CLOSING",{enumerable:!0,value:ke.indexOf("CLOSING")});Object.defineProperty(v.prototype,"CLOSING",{enumerable:!0,value:ke.indexOf("CLOSING")});Object.defineProperty(v,"CLOSED",{enumerable:!0,value:ke.indexOf("CLOSED")});Object.defineProperty(v.prototype,"CLOSED",{enumerable:!0,value:ke.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(s=>{Object.defineProperty(v.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty(v.prototype,`on${s}`,{enumerable:!0,get(){for(let t of this.listeners(s))if(t[Ss])return t[Uf];return null},set(t){for(let n of this.listeners(s))if(n[Ss]){this.removeListener(s,n);break}typeof t=="function"&&this.addEventListener(s,t,{[Ss]:!0})}})});v.prototype.addEventListener=zf;v.prototype.removeEventListener=jf;Oa.exports=v;function va(s,t,n,o){let a=Ee(X({protocolVersion:ws[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},o),{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0});if(!ws.includes(a.protocolVersion))throw new RangeError(`Unsupported protocol version: ${a.protocolVersion} (supported versions: ${ws.join(", ")})`);let l;if(t instanceof gs)l=t,s._url=t.href;else{try{l=new gs(t)}catch{throw new SyntaxError(`Invalid URL: ${t}`)}s._url=t}let f=l.protocol==="wss:",m=l.protocol==="ws+unix:",d;if(l.protocol!=="ws:"&&!f&&!m?d=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:m&&!l.pathname?d="The URL's pathname is empty":l.hash&&(d="The URL contains a fragment identifier"),d){let T=new SyntaxError(d);if(s._redirects===0)throw T;Rs(s,T);return}let h=f?443:80,b=If(16).toString("base64"),g=f?Lf.get:Df.get,w=new Set,S;if(a.createConnection=f?Kf:Xf,a.defaultPort=a.defaultPort||h,a.port=l.port||h,a.host=l.hostname.startsWith("[")?l.hostname.slice(1,-1):l.hostname,a.headers=X({"Sec-WebSocket-Version":a.protocolVersion,"Sec-WebSocket-Key":b,Connection:"Upgrade",Upgrade:"websocket"},a.headers),a.path=l.pathname+l.search,a.timeout=a.handshakeTimeout,a.perMessageDeflate&&(S=new Ve(a.perMessageDeflate!==!0?a.perMessageDeflate:{},!1,a.maxPayload),a.headers["Sec-WebSocket-Extensions"]=Hf({[Ve.extensionName]:S.offer()})),n.length){for(let T of n){if(typeof T!="string"||!Yf.test(T)||w.has(T))throw new SyntaxError("An invalid or duplicated subprotocol was specified");w.add(T)}a.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(a.origin&&(a.protocolVersion<13?a.headers["Sec-WebSocket-Origin"]=a.origin:a.headers.Origin=a.origin),(l.username||l.password)&&(a.auth=`${l.username}:${l.password}`),m){let T=a.path.split(":");a.socketPath=T[0],a.path=T[1]}let y=s._req=g(a);a.timeout&&y.on("timeout",()=>{oe(s,y,"Opening handshake has timed out")}),y.on("error",T=>{y===null||y.aborted||(y=s._req=null,Rs(s,T))}),y.on("response",T=>{let P=T.headers.location,A=T.statusCode;if(P&&a.followRedirects&&A>=300&&A<400){if(++s._redirects>a.maxRedirects){oe(s,y,"Maximum redirects exceeded");return}y.abort();let D;try{D=new gs(P,t)}catch{let W=new SyntaxError(`Invalid URL: ${P}`);Rs(s,W);return}va(s,D,n,o)}else s.emit("unexpected-response",y,T)||oe(s,y,`Unexpected server response: ${T.statusCode}`)}),y.on("upgrade",(T,P,A)=>{if(s.emit("upgrade",T),s.readyState!==v.CONNECTING)return;y=s._req=null;let D=Ff("sha1").update(b+Mf).digest("base64");if(T.headers["sec-websocket-accept"]!==D){oe(s,P,"Invalid Sec-WebSocket-Accept header");return}let N=T.headers["sec-websocket-protocol"],W;if(N!==void 0?w.size?w.has(N)||(W="Server sent an invalid subprotocol"):W="Server sent a subprotocol but none was requested":w.size&&(W="Server sent no subprotocol"),W){oe(s,P,W);return}N&&(s._protocol=N);let M=T.headers["sec-websocket-extensions"];if(M!==void 0){if(!S){oe(s,P,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let I;try{I=Gf(M)}catch{oe(s,P,"Invalid Sec-WebSocket-Extensions header");return}let ae=Object.keys(I);if(ae.length!==1||ae[0]!==Ve.extensionName){oe(s,P,"Server indicated an extension that was not requested");return}try{S.accept(I[Ve.extensionName])}catch{oe(s,P,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[Ve.extensionName]=S}s.setSocket(P,A,{generateMask:a.generateMask,maxPayload:a.maxPayload,skipUTF8Validation:a.skipUTF8Validation})})}function Rs(s,t){s._readyState=v.CLOSING,s.emit("error",t),s.emitClose()}function Xf(s){return s.path=s.socketPath,Ca.connect(s)}function Kf(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=Ca.isIP(s.host)?"":s.host),Wf.connect(s)}function oe(s,t,n){s._readyState=v.CLOSING;let o=new Error(n);Error.captureStackTrace(o,oe),t.setHeader?(t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),t.once("abort",s.emitClose.bind(s)),s.emit("error",o)):(t.destroy(o),t.once("error",s.emit.bind(s,"error")),t.once("close",s.emitClose.bind(s)))}function Ts(s,t,n){if(t){let o=Vf(t).length;s._socket?s._sender._bufferedBytes+=o:s._bufferedAmount+=o}if(n){let o=new Error(`WebSocket is not open: readyState ${s.readyState} (${ke[s.readyState]})`);n(o)}}function Zf(s,t){let n=this[G];n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=s,n._socket[G]!==void 0&&(n._socket.removeListener("data",dn),process.nextTick(Aa,n._socket),s===1005?n.close():n.close(s,t))}function Jf(){let s=this[G];s.isPaused||s._socket.resume()}function ec(s){let t=this[G];t._socket[G]!==void 0&&(t._socket.removeListener("data",dn),process.nextTick(Aa,t._socket),t.close(s[$f])),t.emit("error",s)}function Ea(){this[G].emitClose()}function tc(s,t){this[G].emit("message",s,t)}function rc(s){let t=this[G];t.pong(s,!t._isServer,Pa),t.emit("ping",s)}function nc(s){this[G].emit("pong",s)}function Aa(s){s.resume()}function ka(){let s=this[G];this.removeListener("close",ka),this.removeListener("data",dn),this.removeListener("end",xa),s._readyState=v.CLOSING;let t;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(t=s._socket.read())!==null&&s._receiver.write(t),s._receiver.end(),this[G]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",Ea),s._receiver.on("finish",Ea))}function dn(s){this[G]._receiver.write(s)||this.pause()}function xa(){let s=this[G];s._readyState=v.CLOSING,s._receiver.end(),this.end()}function Ba(){let s=this[G];this.removeListener("error",Ba),this.on("error",Pa),s&&(s._readyState=v.CLOSING,this.destroy())}});var Ia=H((Qd,Wa)=>{"use strict";var{Duplex:sc}=require("stream");function La(s){s.emit("close")}function oc(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Da(s){this.removeListener("error",Da),this.destroy(),this.listenerCount("error")===0&&this.emit("error",s)}function ic(s,t){let n=!0,o=new sc(Ee(X({},t),{autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1}));return s.on("message",function(l,f){let m=!f&&o._readableState.objectMode?l.toString():l;o.push(m)||s.pause()}),s.once("error",function(l){o.destroyed||(n=!1,o.destroy(l))}),s.once("close",function(){o.destroyed||o.push(null)}),o._destroy=function(a,l){if(s.readyState===s.CLOSED){l(a),process.nextTick(La,o);return}let f=!1;s.once("error",function(d){f=!0,l(d)}),s.once("close",function(){f||l(a),process.nextTick(La,o)}),n&&s.terminate()},o._final=function(a){if(s.readyState===s.CONNECTING){s.once("open",function(){o._final(a)});return}s._socket!==null&&(s._socket._writableState.finished?(a(),o._readableState.endEmitted&&o.destroy()):(s._socket.once("finish",function(){a()}),s.close()))},o._read=function(){s.isPaused&&s.resume()},o._write=function(a,l,f){if(s.readyState===s.CONNECTING){s.once("open",function(){o._write(a,l,f)});return}s.send(a,f)},o.on("end",oc),o.on("error",Da),o}Wa.exports=ic});var qa=H((Xd,Fa)=>{"use strict";var{tokenChars:ac}=fr();function lc(s){let t=new Set,n=-1,o=-1,a=0;for(a;a<s.length;a++){let f=s.charCodeAt(a);if(o===-1&&ac[f]===1)n===-1&&(n=a);else if(a!==0&&(f===32||f===9))o===-1&&n!==-1&&(o=a);else if(f===44){if(n===-1)throw new SyntaxError(`Unexpected character at index ${a}`);o===-1&&(o=a);let m=s.slice(n,o);if(t.has(m))throw new SyntaxError(`The "${m}" subprotocol is duplicated`);t.add(m),n=o=-1}else throw new SyntaxError(`Unexpected character at index ${a}`)}if(n===-1||o!==-1)throw new SyntaxError("Unexpected end of input");let l=s.slice(n,a);if(t.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);return t.add(l),t}Fa.exports={parse:lc}});var Ha=H((eh,ja)=>{"use strict";var uc=require("events"),hn=require("http"),Kd=require("https"),Zd=require("net"),Jd=require("tls"),{createHash:fc}=require("crypto"),Na=ys(),it=ur(),cc=qa(),dc=Es(),{GUID:hc,kWebSocket:mc}=je(),pc=/^[+/0-9A-Za-z]{22}==$/,Ma=0,Ua=1,$a=2,za=class extends uc{constructor(t,n){super();if(t=X({maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},t),t.port==null&&!t.server&&!t.noServer||t.port!=null&&(t.server||t.noServer)||t.server&&t.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(t.port!=null?(this._server=hn.createServer((o,a)=>{let l=hn.STATUS_CODES[426];a.writeHead(426,{"Content-Length":l.length,"Content-Type":"text/plain"}),a.end(l)}),this._server.listen(t.port,t.host,t.backlog,n)):t.server&&(this._server=t.server),this._server){let o=this.emit.bind(this,"connection");this._removeListeners=_c(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(a,l,f)=>{this.handleUpgrade(a,l,f,o)}})}t.perMessageDeflate===!0&&(t.perMessageDeflate={}),t.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=t,this._state=Ma}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(t){if(this._state===$a){t&&this.once("close",()=>{t(new Error("The server is not running"))}),process.nextTick(mr,this);return}if(t&&this.once("close",t),this._state!==Ua)if(this._state=Ua,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(mr,this):process.nextTick(mr,this);else{let n=this._server;this._removeListeners(),this._removeListeners=this._server=null,n.close(()=>{mr(this)})}}shouldHandle(t){if(this.options.path){let n=t.url.indexOf("?");if((n!==-1?t.url.slice(0,n):t.url)!==this.options.path)return!1}return!0}handleUpgrade(t,n,o,a){n.on("error",Cs);let l=t.headers["sec-websocket-key"]!==void 0?t.headers["sec-websocket-key"]:!1,f=+t.headers["sec-websocket-version"];if(t.method!=="GET"||t.headers.upgrade.toLowerCase()!=="websocket"||!l||!pc.test(l)||f!==8&&f!==13||!this.shouldHandle(t))return xt(n,400);let m=t.headers["sec-websocket-protocol"],d=new Set;if(m!==void 0)try{d=cc.parse(m)}catch{return xt(n,400)}let h=t.headers["sec-websocket-extensions"],b={};if(this.options.perMessageDeflate&&h!==void 0){let g=new it(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let w=Na.parse(h);w[it.extensionName]&&(g.accept(w[it.extensionName]),b[it.extensionName]=g)}catch{return xt(n,400)}}if(this.options.verifyClient){let g={origin:t.headers[`${f===8?"sec-websocket-origin":"origin"}`],secure:!!(t.socket.authorized||t.socket.encrypted),req:t};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(w,S,y,T)=>{if(!w)return xt(n,S||401,y,T);this.completeUpgrade(b,l,d,t,n,o,a)});return}if(!this.options.verifyClient(g))return xt(n,401)}this.completeUpgrade(b,l,d,t,n,o,a)}completeUpgrade(t,n,o,a,l,f,m){if(!l.readable||!l.writable)return l.destroy();if(l[mc])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ma)return xt(l,503);let d=fc("sha1").update(n+hc).digest("base64"),h=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${d}`],b=new dc(null);if(o.size){let g=this.options.handleProtocols?this.options.handleProtocols(o,a):o.values().next().value;g&&(h.push(`Sec-WebSocket-Protocol: ${g}`),b._protocol=g)}if(t[it.extensionName]){let g=t[it.extensionName].params,w=Na.format({[it.extensionName]:[g]});h.push(`Sec-WebSocket-Extensions: ${w}`),b._extensions=t}this.emit("headers",h,a),l.write(h.concat(`\r
`).join(`\r
`)),l.removeListener("error",Cs),b.setSocket(l,f,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(b),b.on("close",()=>{this.clients.delete(b),this._shouldEmitClose&&!this.clients.size&&process.nextTick(mr,this)})),m(b,a)}};ja.exports=za;function _c(s,t){for(let n of Object.keys(t))s.on(n,t[n]);return function(){for(let o of Object.keys(t))s.removeListener(o,t[o])}}function mr(s){s._state=$a,s.emit("close")}function Cs(){this.destroy()}function xt(s,t,n,o){s.writable&&(n=n||hn.STATUS_CODES[t],o=X({Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n)},o),s.write(`HTTP/1.1 ${t} ${hn.STATUS_CODES[t]}\r
`+Object.keys(o).map(a=>`${a}: ${o[a]}`).join(`\r
`)+`\r
\r
`+n)),s.removeListener("error",Cs),s.destroy()}});var Va=H((th,Ga)=>{"use strict";var xe=Es();xe.createWebSocketStream=Ia();xe.Server=Ha();xe.Receiver=ps();xe.Sender=_s();xe.WebSocket=xe;xe.WebSocketServer=xe.Server;Ga.exports=xe});var Pc={};Zo(Pc,{default:()=>ol});var C=require("@raycast/api"),vt=require("react");var $e=require("@raycast/api");var ki=tt(require("node:http"),1),xi=tt(require("node:https"),1),ot=tt(require("node:zlib"),1),te=tt(require("node:stream"),1);function Nu(s){if(!/^data:/i.test(s))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');s=s.replace(/\r?\n/g,"");let t=s.indexOf(",");if(t===-1||t<=4)throw new TypeError("malformed data: URI");let n=s.substring(5,t).split(";"),o="",a=!1,l=n[0]||"text/plain",f=l;for(let b=1;b<n.length;b++)n[b]==="base64"?a=!0:(f+=`;${n[b]}`,n[b].indexOf("charset=")===0&&(o=n[b].substring(8)));!n[0]&&!o.length&&(f+=";charset=US-ASCII",o="US-ASCII");let m=a?"base64":"ascii",d=unescape(s.substring(t+1)),h=Buffer.from(d,m);return h.type=l,h.typeFull=f,h.charset=o,h}var ei=Nu;var de=tt(require("node:stream"),1),Rt=require("node:util");Xt();Jn();var Ne=class extends Error{constructor(t,n){super(t);Error.captureStackTrace(this,this.constructor),this.type=n}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var se=class extends Ne{constructor(t,n,o){super(t,n);o&&(this.code=this.errno=o.code,this.erroredSysCall=o.syscall)}};var Xr=Symbol.toStringTag,es=s=>typeof s=="object"&&typeof s.append=="function"&&typeof s.delete=="function"&&typeof s.get=="function"&&typeof s.getAll=="function"&&typeof s.has=="function"&&typeof s.set=="function"&&typeof s.sort=="function"&&s[Xr]==="URLSearchParams",Jt=s=>s&&typeof s=="object"&&typeof s.arrayBuffer=="function"&&typeof s.type=="string"&&typeof s.stream=="function"&&typeof s.constructor=="function"&&/^(Blob|File)$/.test(s[Xr]),ui=s=>typeof s=="object"&&(s[Xr]==="AbortSignal"||s[Xr]==="EventTarget");var K=Symbol("Body internals"),Ce=class{constructor(t,{size:n=0}={}){let o=null;t===null?t=null:es(t)?t=Buffer.from(t.toString()):Jt(t)||Buffer.isBuffer(t)||(Rt.types.isAnyArrayBuffer(t)?t=Buffer.from(t):ArrayBuffer.isView(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof de.default||(t instanceof wt?(t=li(t),o=t.type.split("=")[1]):t=Buffer.from(String(t))));let a=t;Buffer.isBuffer(t)?a=de.default.Readable.from(t):Jt(t)&&(a=de.default.Readable.from(t.stream())),this[K]={body:t,stream:a,boundary:o,disturbed:!1,error:null},this.size=n,t instanceof de.default&&t.on("error",l=>{let f=l instanceof Ne?l:new se(`Invalid response body while trying to fetch ${this.url}: ${l.message}`,"system",l);this[K].error=f})}get body(){return this[K].stream}get bodyUsed(){return this[K].disturbed}async arrayBuffer(){let{buffer:t,byteOffset:n,byteLength:o}=await Jr(this);return t.slice(n,n+o)}async formData(){let t=this.headers.get("content-type");if(t.startsWith("application/x-www-form-urlencoded")){let o=new wt,a=new URLSearchParams(await this.text());for(let[l,f]of a)o.append(l,f);return o}let{toFormData:n}=await Promise.resolve().then(()=>(pi(),mi));return n(this.body,t)}async blob(){let t=this.headers&&this.headers.get("content-type")||this[K].body&&this[K].body.type||"",n=await this.buffer();return new rt([n],{type:t})}async json(){let t=await Jr(this);return JSON.parse(t.toString())}async text(){return(await Jr(this)).toString()}buffer(){return Jr(this)}};Ce.prototype.buffer=(0,Rt.deprecate)(Ce.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(Ce.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}});async function Jr(s){if(s[K].disturbed)throw new TypeError(`body used already for: ${s.url}`);if(s[K].disturbed=!0,s[K].error)throw s[K].error;let{body:t}=s;if(t===null||!(t instanceof de.default))return Buffer.alloc(0);let n=[],o=0;try{for await(let a of t){if(s.size>0&&o+a.length>s.size){let l=new se(`content size at ${s.url} over limit: ${s.size}`,"max-size");throw t.destroy(l),l}o+=a.length,n.push(a)}}catch(a){throw a instanceof Ne?a:new se(`Invalid response body while trying to fetch ${s.url}: ${a.message}`,"system",a)}if(t.readableEnded===!0||t._readableState.ended===!0)try{return n.every(a=>typeof a=="string")?Buffer.from(n.join("")):Buffer.concat(n,o)}catch(a){throw new se(`Could not create Buffer from response body for ${s.url}: ${a.message}`,"system",a)}else throw new se(`Premature close of server response while trying to fetch ${s.url}`)}var Tt=(s,t)=>{let n,o,{body:a}=s[K];if(s.bodyUsed)throw new Error("cannot clone body after it is used");return a instanceof de.default&&typeof a.getBoundary!="function"&&(n=new de.PassThrough({highWaterMark:t}),o=new de.PassThrough({highWaterMark:t}),a.pipe(n),a.pipe(o),s[K].stream=n,a=o),a},tf=(0,Rt.deprecate)(s=>s.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),en=(s,t)=>s===null?null:typeof s=="string"?"text/plain;charset=UTF-8":es(s)?"application/x-www-form-urlencoded;charset=UTF-8":Jt(s)?s.type||null:Buffer.isBuffer(s)||Rt.types.isAnyArrayBuffer(s)||ArrayBuffer.isView(s)?null:s instanceof wt?`multipart/form-data; boundary=${t[K].boundary}`:s&&typeof s.getBoundary=="function"?`multipart/form-data;boundary=${tf(s)}`:s instanceof de.default?null:"text/plain;charset=UTF-8",_i=s=>{let{body:t}=s[K];return t===null?0:Jt(t)?t.size:Buffer.isBuffer(t)?t.length:t&&typeof t.getLengthSync=="function"&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null},bi=(s,{body:t})=>{t===null?s.end():t.pipe(s)};var rs=require("node:util"),rr=tt(require("node:http"),1),tn=typeof rr.default.validateHeaderName=="function"?rr.default.validateHeaderName:s=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(s)){let t=new TypeError(`Header name must be a valid HTTP token [${s}]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),t}},ns=typeof rr.default.validateHeaderValue=="function"?rr.default.validateHeaderValue:(s,t)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(t)){let n=new TypeError(`Invalid character in header content ["${s}"]`);throw Object.defineProperty(n,"code",{value:"ERR_INVALID_CHAR"}),n}},ee=class extends URLSearchParams{constructor(t){let n=[];if(t instanceof ee){let o=t.raw();for(let[a,l]of Object.entries(o))n.push(...l.map(f=>[a,f]))}else if(t!=null)if(typeof t=="object"&&!rs.types.isBoxedPrimitive(t)){let o=t[Symbol.iterator];if(o==null)n.push(...Object.entries(t));else{if(typeof o!="function")throw new TypeError("Header pairs must be iterable");n=[...t].map(a=>{if(typeof a!="object"||rs.types.isBoxedPrimitive(a))throw new TypeError("Each header pair must be an iterable object");return[...a]}).map(a=>{if(a.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...a]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");n=n.length>0?n.map(([o,a])=>(tn(o),ns(o,String(a)),[String(o).toLowerCase(),String(a)])):void 0;super(n);return new Proxy(this,{get(o,a,l){switch(a){case"append":case"set":return(f,m)=>(tn(f),ns(f,String(m)),URLSearchParams.prototype[a].call(o,String(f).toLowerCase(),String(m)));case"delete":case"has":case"getAll":return f=>(tn(f),URLSearchParams.prototype[a].call(o,String(f).toLowerCase()));case"keys":return()=>(o.sort(),new Set(URLSearchParams.prototype.keys.call(o)).keys());default:return Reflect.get(o,a,l)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(t){let n=this.getAll(t);if(n.length===0)return null;let o=n.join(", ");return/^content-encoding$/i.test(t)&&(o=o.toLowerCase()),o}forEach(t,n=void 0){for(let o of this.keys())Reflect.apply(t,n,[this.get(o),o,this])}*values(){for(let t of this.keys())yield this.get(t)}*entries(){for(let t of this.keys())yield[t,this.get(t)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((t,n)=>(t[n]=this.getAll(n),t),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((t,n)=>{let o=this.getAll(n);return n==="host"?t[n]=o[0]:t[n]=o.length>1?o:o[0],t},{})}};Object.defineProperties(ee.prototype,["get","entries","forEach","values"].reduce((s,t)=>(s[t]={enumerable:!0},s),{}));function yi(s=[]){return new ee(s.reduce((t,n,o,a)=>(o%2===0&&t.push(a.slice(o,o+2)),t),[]).filter(([t,n])=>{try{return tn(t),ns(t,String(n)),!0}catch{return!1}}))}var rf=new Set([301,302,303,307,308]),rn=s=>rf.has(s);var he=Symbol("Response internals"),Z=class extends Ce{constructor(t=null,n={}){super(t,n);let o=n.status!=null?n.status:200,a=new ee(n.headers);if(t!==null&&!a.has("Content-Type")){let l=en(t,this);l&&a.append("Content-Type",l)}this[he]={type:"default",url:n.url,status:o,statusText:n.statusText||"",headers:a,counter:n.counter,highWaterMark:n.highWaterMark}}get type(){return this[he].type}get url(){return this[he].url||""}get status(){return this[he].status}get ok(){return this[he].status>=200&&this[he].status<300}get redirected(){return this[he].counter>0}get statusText(){return this[he].statusText}get headers(){return this[he].headers}get highWaterMark(){return this[he].highWaterMark}clone(){return new Z(Tt(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(t,n=302){if(!rn(n))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new Z(null,{headers:{location:new URL(t).toString()},status:n})}static error(){let t=new Z(null,{status:0,statusText:""});return t[he].type="error",t}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(Z.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var vi=require("node:url");var gi=s=>{if(s.search)return s.search;let t=s.href.length-1,n=s.hash||(s.href[t]==="#"?"#":"");return s.href[t-n.length]==="?"?"?":""};var wi=require("net");function Si(s,t=!1){return s==null||(s=new URL(s),/^(about|blob|data):$/.test(s.protocol))?"no-referrer":(s.username="",s.password="",s.hash="",t&&(s.pathname="",s.search=""),s)}var Ri=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Ti="strict-origin-when-cross-origin";function Ei(s){if(!Ri.has(s))throw new TypeError(`Invalid referrerPolicy: ${s}`);return s}function nf(s){if(/^(http|ws)s:$/.test(s.protocol))return!0;let t=s.host.replace(/(^\[)|(]$)/g,""),n=(0,wi.isIP)(t);return n===4&&/^127\./.test(t)||n===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t)?!0:/^(.+\.)*localhost$/.test(s.host)?!1:s.protocol==="file:"}function Et(s){return/^about:(blank|srcdoc)$/.test(s)||s.protocol==="data:"||/^(blob|filesystem):$/.test(s.protocol)?!0:nf(s)}function Ci(s,{referrerURLCallback:t,referrerOriginCallback:n}={}){if(s.referrer==="no-referrer"||s.referrerPolicy==="")return null;let o=s.referrerPolicy;if(s.referrer==="about:client")return"no-referrer";let a=s.referrer,l=Si(a),f=Si(a,!0);l.toString().length>4096&&(l=f),t&&(l=t(l)),n&&(f=n(f));let m=new URL(s.url);switch(o){case"no-referrer":return"no-referrer";case"origin":return f;case"unsafe-url":return l;case"strict-origin":return Et(l)&&!Et(m)?"no-referrer":f.toString();case"strict-origin-when-cross-origin":return l.origin===m.origin?l:Et(l)&&!Et(m)?"no-referrer":f;case"same-origin":return l.origin===m.origin?l:"no-referrer";case"origin-when-cross-origin":return l.origin===m.origin?l:f;case"no-referrer-when-downgrade":return Et(l)&&!Et(m)?"no-referrer":l;default:throw new TypeError(`Invalid referrerPolicy: ${o}`)}}function Pi(s){let t=(s.get("referrer-policy")||"").split(/[,\s]+/),n="";for(let o of t)o&&Ri.has(o)&&(n=o);return n}var j=Symbol("Request internals"),nn=s=>typeof s=="object"&&typeof s[j]=="object",Ue=class extends Ce{constructor(t,n={}){let o;if(nn(t)?o=new URL(t.url):(o=new URL(t),t={}),o.username!==""||o.password!=="")throw new TypeError(`${o} is an url with embedded credentails.`);let a=n.method||t.method||"GET";if(a=a.toUpperCase(),(n.body!=null||nn(t))&&t.body!==null&&(a==="GET"||a==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let l=n.body?n.body:nn(t)&&t.body!==null?Tt(t):null;super(l,{size:n.size||t.size||0});let f=new ee(n.headers||t.headers||{});if(l!==null&&!f.has("Content-Type")){let h=en(l,this);h&&f.set("Content-Type",h)}let m=nn(t)?t.signal:null;if("signal"in n&&(m=n.signal),m!=null&&!ui(m))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let d=n.referrer==null?t.referrer:n.referrer;if(d==="")d="no-referrer";else if(d){let h=new URL(d);d=/^about:(\/\/)?client$/.test(h)?"client":h}else d=void 0;this[j]={method:a,redirect:n.redirect||t.redirect||"follow",headers:f,parsedURL:o,signal:m,referrer:d},this.follow=n.follow===void 0?t.follow===void 0?20:t.follow:n.follow,this.compress=n.compress===void 0?t.compress===void 0?!0:t.compress:n.compress,this.counter=n.counter||t.counter||0,this.agent=n.agent||t.agent,this.highWaterMark=n.highWaterMark||t.highWaterMark||16384,this.insecureHTTPParser=n.insecureHTTPParser||t.insecureHTTPParser||!1,this.referrerPolicy=n.referrerPolicy||t.referrerPolicy||""}get method(){return this[j].method}get url(){return(0,vi.format)(this[j].parsedURL)}get headers(){return this[j].headers}get redirect(){return this[j].redirect}get signal(){return this[j].signal}get referrer(){if(this[j].referrer==="no-referrer")return"";if(this[j].referrer==="client")return"about:client";if(this[j].referrer)return this[j].referrer.toString()}get referrerPolicy(){return this[j].referrerPolicy}set referrerPolicy(t){this[j].referrerPolicy=Ei(t)}clone(){return new Ue(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Ue.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var Ai=s=>{let{parsedURL:t}=s[j],n=new ee(s[j].headers);n.has("Accept")||n.set("Accept","*/*");let o=null;if(s.body===null&&/^(post|put)$/i.test(s.method)&&(o="0"),s.body!==null){let m=_i(s);typeof m=="number"&&!Number.isNaN(m)&&(o=String(m))}o&&n.set("Content-Length",o),s.referrerPolicy===""&&(s.referrerPolicy=Ti),s.referrer&&s.referrer!=="no-referrer"?s[j].referrer=Ci(s):s[j].referrer="no-referrer",s[j].referrer instanceof URL&&n.set("Referer",s.referrer),n.has("User-Agent")||n.set("User-Agent","node-fetch"),s.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate,br");let{agent:a}=s;typeof a=="function"&&(a=a(t)),!n.has("Connection")&&!a&&n.set("Connection","close");let l=gi(t),f={path:t.pathname+l,method:s.method,headers:n[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:s.insecureHTTPParser,agent:a};return{parsedURL:t,options:f}};var ss=class extends Ne{constructor(t,n="aborted"){super(t,n)}};var sf=new Set(["data:","http:","https:"]);async function sn(s,t){return new Promise((n,o)=>{let a=new Ue(s,t),{parsedURL:l,options:f}=Ai(a);if(!sf.has(l.protocol))throw new TypeError(`node-fetch cannot load ${s}. URL scheme "${l.protocol.replace(/:$/,"")}" is not supported.`);if(l.protocol==="data:"){let y=ei(a.url),T=new Z(y,{headers:{"Content-Type":y.typeFull}});n(T);return}let m=(l.protocol==="https:"?xi.default:ki.default).request,{signal:d}=a,h=null,b=()=>{let y=new ss("The operation was aborted.");o(y),a.body&&a.body instanceof te.default.Readable&&a.body.destroy(y),!(!h||!h.body)&&h.body.emit("error",y)};if(d&&d.aborted){b();return}let g=()=>{b(),S()},w=m(l,f);d&&d.addEventListener("abort",g);let S=()=>{w.abort(),d&&d.removeEventListener("abort",g)};w.on("error",y=>{o(new se(`request to ${a.url} failed, reason: ${y.message}`,"system",y)),S()}),of(w,y=>{h.body.destroy(y)}),process.version<"v14"&&w.on("socket",y=>{let T;y.prependListener("end",()=>{T=y._eventsCount}),y.prependListener("close",P=>{if(h&&T<y._eventsCount&&!P){let A=new Error("Premature close");A.code="ERR_STREAM_PREMATURE_CLOSE",h.body.emit("error",A)}})}),w.on("response",y=>{w.setTimeout(0);let T=yi(y.rawHeaders);if(rn(y.statusCode)){let W=T.get("Location"),M=W===null?null:new URL(W,a.url);switch(a.redirect){case"error":o(new se(`uri requested responds with a redirect, redirect mode is set to error: ${a.url}`,"no-redirect")),S();return;case"manual":M!==null&&T.set("Location",M);break;case"follow":{if(M===null)break;if(a.counter>=a.follow){o(new se(`maximum redirect reached at: ${a.url}`,"max-redirect")),S();return}let I={headers:new ee(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:Tt(a),signal:a.signal,size:a.size,referrer:a.referrer,referrerPolicy:a.referrerPolicy};if(y.statusCode!==303&&a.body&&t.body instanceof te.default.Readable){o(new se("Cannot follow redirect with body being a readable stream","unsupported-redirect")),S();return}(y.statusCode===303||(y.statusCode===301||y.statusCode===302)&&a.method==="POST")&&(I.method="GET",I.body=void 0,I.headers.delete("content-length"));let ae=Pi(T);ae&&(I.referrerPolicy=ae),n(sn(new Ue(M,I))),S();return}default:return o(new TypeError(`Redirect option '${a.redirect}' is not a valid value of RequestRedirect`))}}d&&y.once("end",()=>{d.removeEventListener("abort",g)});let P=(0,te.pipeline)(y,new te.PassThrough,o);process.version<"v12.10"&&y.on("aborted",g);let A={url:a.url,status:y.statusCode,statusText:y.statusMessage,headers:T,size:a.size,counter:a.counter,highWaterMark:a.highWaterMark},D=T.get("Content-Encoding");if(!a.compress||a.method==="HEAD"||D===null||y.statusCode===204||y.statusCode===304){h=new Z(P,A),n(h);return}let N={flush:ot.default.Z_SYNC_FLUSH,finishFlush:ot.default.Z_SYNC_FLUSH};if(D==="gzip"||D==="x-gzip"){P=(0,te.pipeline)(P,ot.default.createGunzip(N),o),h=new Z(P,A),n(h);return}if(D==="deflate"||D==="x-deflate"){(0,te.pipeline)(y,new te.PassThrough,o).once("data",M=>{P=(M[0]&15)===8?(0,te.pipeline)(P,ot.default.createInflate(),o):(0,te.pipeline)(P,ot.default.createInflateRaw(),o),h=new Z(P,A),n(h)});return}if(D==="br"){P=(0,te.pipeline)(P,ot.default.createBrotliDecompress(),o),h=new Z(P,A),n(h);return}h=new Z(P,A),n(h)}),bi(w,a)})}function of(s,t){let n=Buffer.from(`0\r
\r
`),o=!1,a=!1,l;s.on("response",f=>{let{headers:m}=f;o=m["transfer-encoding"]==="chunked"&&!m["content-length"]}),s.on("socket",f=>{let m=()=>{if(o&&!a){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",t(d)}};f.prependListener("close",m),s.on("abort",()=>{f.removeListener("close",m)}),f.on("data",d=>{a=Buffer.compare(d.slice(-5),n)===0,!a&&l&&(a=Buffer.compare(l.slice(-3),n.slice(0,3))===0&&Buffer.compare(d.slice(-2),n.slice(3))===0),l=d})})}var is=require("url");var Ct=require("@raycast/api");var nr=new Error("No avaliable backend"),os=new Error("Current backend deleted"),_e=function(s){switch(s){case nr:{(0,Ct.showToast)(Ct.Toast.Style.Failure,nr.message,"Configure in 'Backends'");break}case os:{(0,Ct.showToast)(Ct.Toast.Style.Failure,nr.message,"Configure in 'Backends'");break}default:console.error(s),sr("Request failed",s)}};var Bi=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];function ze(s){if(s<1e3)return s+" B";let t=Math.min(Math.floor(Math.log10(s)/3),Bi.length-1);s=Number((s/Math.pow(1e3,t)).toPrecision(3));let n=Bi[t];return s+" "+n}async function as(){return await $e.LocalStorage.getItem("current")}async function af(s){return await $e.LocalStorage.getItem(s)}async function Oi(){let s=await as();if(s){let t=await af(s);if(t==null)throw os;return[s,t]}else throw nr}async function Pt({endpoint:s,method:t="GET",body:n}){let[o,a]=await Oi(),l=new is.URL(o),f=`${Di(l.href)}${s}`;return sn(f,{method:t,headers:a?{Authorization:`Bearer ${a}`}:{},body:n?JSON.stringify(n):void 0})}async function Li(s,t={}){let[n,o]=await Oi(),a=new is.URL(n);a.protocol==="https:"?a.protocol="wss:":a.protocol="ws:";let l=new URLSearchParams(t);l.set("token",o);let f="?"+l.toString();return`${Di(a.href)}${s}${f}`}function Di(s){return s.replace(/\/$/,"")}async function ls(s){await $e.LocalStorage.setItem("current",s)}async function sr(s,t){console.error(s,t),await(0,$e.showToast)($e.Toast.Style.Failure,s,t instanceof Error?t.message:t.toString())}function Wi(s){return new Promise(t=>setTimeout(t,s))}function or(s,t){let n=String(s);for(;n.length<t;)n="0"+n;return n}function lf(s){let t=s.getFullYear()%100,n=or(s.getMonth()+1,2),o=or(s.getDate(),2),a=or(s.getHours(),2),l=or(s.getMinutes(),2),f=or(s.getSeconds(),2);return`${t}-${n}-${o} ${a}:${l}:${f}`}function Ii(){return lf(new Date).toString()}function Fi(s){return s.charAt(0).toUpperCase()+s.slice(1)}async function uf(){return await C.LocalStorage.allItems()}async function ff(s,t){await C.LocalStorage.setItem(s,t)}async function cf(s){await C.LocalStorage.removeItem(s)}function us(){let[s,t]=(0,vt.useState)(0),{pop:n}=(0,C.useNavigation)(),[o,a]=(0,vt.useState)({}),[l,f]=(0,vt.useState)("");(0,vt.useEffect)(()=>{(async()=>{let h=await as();h&&f(h);let b=await uf();a(b)})()},[s]);let m=Object.entries(o).filter(([d])=>d!="current").sort((d,h)=>d[0].localeCompare(h[0]));return _jsx(C.List,null,m.map(([d,h],b)=>_jsx(C.List.Item,{title:d,icon:{source:C.Icon.Circle,tintColor:d==l?C.Color.Green:C.Color.PrimaryText},key:b,subtitle:h&&h.length!=0?h:"(no secret)",accessoryTitle:d==l?"Current":"",actions:_jsx(C.ActionPanel,null,_jsx(C.Action,{title:"Use Backend",onAction:async()=>{await ls(d),f(d)}}),_jsx(C.Action,{title:"Remove",onAction:async()=>{await(0,C.confirmAlert)({title:"Delete this backend?",primaryAction:{title:"Confirm",onAction:async()=>{await cf(d),t(w=>w+1),(0,C.showToast)(C.Toast.Style.Success,"Delete Success",d)}}})}}))})),_jsx(C.List.Item,{title:"Add Backend",icon:{source:C.Icon.Plus,tintColor:C.Color.Blue},key:m.length,actions:_jsx(C.ActionPanel,null,_jsx(C.Action.Push,{title:"Add Backend",target:_jsx(C.Form,{actions:_jsx(C.ActionPanel,null,_jsx(C.Action.SubmitForm,{title:"Submit",onSubmit:async d=>{d.url.startsWith("http://")||d.url.startsWith("https://")?(await ff(d.url,d.secret),await ls(d.url),f(d.url),t(h=>h+1),(0,C.showToast)(C.Toast.Style.Success,"Add Success",d.url),n()):await(0,C.showToast)(C.Toast.Style.Failure,"invalid url")}}))},_jsx(C.Form.TextField,{id:"url",title:"url",defaultValue:"http://127.0.0.1:9090"}),_jsx(C.Form.TextField,{id:"secret",title:"secret",defaultValue:""}))}))}),_jsx(C.List.Item,{title:"Delete All Data",icon:{source:C.Icon.Trash,tintColor:C.Color.Red},key:m.length+1,actions:_jsx(C.ActionPanel,null,_jsx(C.Action,{title:"Remove",onAction:async()=>{await(0,C.confirmAlert)({title:"Delete All Data?",primaryAction:{title:"Confirm",onAction:async()=>{await C.LocalStorage.clear(),t(h=>h+1),(0,C.showToast)(C.Toast.Style.Success,"Delete Success")}}})}}))}))}var at=require("@raycast/api"),Xa=require("react");var Be=require("react");var ye=require("react");var bc=Va(),Ps=[{key:0,value:"connecting"},{key:1,value:"connection ready"},{key:2,value:"connection is closing"},{key:3,value:"connection closed or error"}],yc=(s,t={})=>{let n=(0,ye.useRef)(null),o=(0,ye.useRef)(!0),[a,l]=(0,ye.useState)(0),[f,m]=(0,ye.useState)(""),[d,h]=(0,ye.useState)(""),[b,g]=(0,ye.useState)({key:0,value:"connecting"}),w=()=>{Li(s,t).then(P=>{o.current&&m(P),n.current=new bc(P),n.current.onopen=A=>o.current&&g(Ps[n.current?.readyState??0]),n.current.onclose=A=>{o.current&&g(Ps[n.current?.readyState??0])},n.current.onerror=A=>{o.current&&g(Ps[n.current?.readyState??0])},n.current.onmessage=A=>{o.current&&h(A.data.toString())}}).catch(_e)},S=()=>{(!n.current||n.current.readyState===3)&&w()},y=()=>{n.current?.close()},T=()=>{o.current&&a<=10&&(console.log(`reconnect after ${a}s(${a}/10)`),sr(`Reconnect after ${a}s(${a}/10)`,""),Wi(a*1e3).then(()=>{console.log("reconnect"),o.current&&l(P=>P+1);try{y(),n.current=null,o.current&&w()}catch(P){sr("Websocket failed",P)}}))};return(0,ye.useEffect)(()=>(S(),()=>{n.current?.close(),o.current=!1}),[n]),{url:f,wsData:d,readyState:b,closeWebSocket:y,reconnect:T}},mn=yc;function Ya(){let[s,t]=(0,Be.useState)({up:0,down:0}),{url:n,wsData:o,readyState:a,reconnect:l}=mn("/traffic");return(0,Be.useEffect)(()=>{if(a.key===3&&l(),o){let f=JSON.parse(o);t(f)}},[o,a]),[n,s]}function pn(){let[s,t]=(0,Be.useState)({downloadTotal:0,uploadTotal:0,connections:[]}),{url:n,wsData:o,readyState:a,reconnect:l}=mn("/connections");return(0,Be.useEffect)(()=>{if(a.key===3&&l(),o){let f=JSON.parse(o);t(f)}},[o,a]),[n,s]}function Qa(s){let[t,n]=(0,Be.useState)([]),{url:o,wsData:a,readyState:l,reconnect:f,closeWebSocket:m}=mn("/logs",{level:s});return(0,Be.useEffect)(()=>{if(l.key===3&&f(),a){let d=JSON.parse(a);n(h=>[Ee(X({},d),{time:Ii()}),...h])}},[a,l]),(0,Be.useEffect)(()=>{o&&(m(),f())},[s]),[o,t]}function gc(s,t){return`${t.metadata.host?t.metadata.host:t.metadata.destinationIP}:${t.metadata.destinationPort}`}function Sc(s,t){return s?`${t.chains.join(" / ")}`:`${t.rule}(${t.rulePayload})`}function wc(s,t){return s?`${ze(t.download)}/s \u2193 ${ze(t.upload)}/s \u2191`:`${t.metadata.type}(${t.metadata.network})`}function vs(){let[s,t]=pn(),[n,o]=(0,Xa.useState)(!0);return _jsx(at.List,null,s?_jsx(_jsxFragment,null,_jsx(at.List.Item,{key:-1,title:"Host",subtitle:n?"Chains":"Rules",accessoryTitle:`${n?"Overview":"Detail"} Mode`,actions:_jsx(at.ActionPanel,null,_jsx(at.ActionPanel.Item,{title:"Switch Mode",onAction:()=>{o(a=>!a)}}))}),t.connections.map((a,l)=>_jsx(at.List.Item,{key:l,title:gc(n,a),subtitle:Sc(n,a),accessoryTitle:wc(n,a)}))):_jsx(_jsxFragment,null))}var z=require("@raycast/api"),Ka=require("react");var _n=["error","warning","info","debug"],Rc={debug:z.Color.Green,info:z.Color.Blue,warning:z.Color.Yellow,error:z.Color.Red};function As(){let[s,t]=(0,Ka.useState)("info"),[n,o]=Qa(s);return _jsx(z.List,null,n?_jsx(_jsxFragment,null,_jsx(z.List.Item,{key:-1,title:"Time",subtitle:"Payload",accessoryTitle:`LogLevel(${s})`,actions:_jsx(z.ActionPanel,null,_jsx(z.Action,{title:"Swith Level",onAction:()=>{t(a=>{let l=_n.indexOf(a);return l>=_n.length-1?_n[0]:_n[l+1]})}}))}),o.map((a,l)=>_jsx(z.List.Item,{icon:{source:z.Icon.Circle,tintColor:Rc[a.type]},key:l,title:a.time?a.time:"",subtitle:a.payload,accessoryTitle:a.type,actions:_jsx(z.ActionPanel,null,_jsx(z.Action.Push,{title:"Show Detail",target:_jsx(z.Detail,{markdown:`\`\`\`
${a.payload}
\`\`\``})}))}))):_jsx(_jsxFragment,null))}var re=require("@raycast/api");function ks(){let[s,t]=Ya(),[n,o]=pn();return _jsx(re.List,null,s&&n?_jsx(_jsxFragment,null,_jsx(re.List.Item,{key:"1",icon:re.Icon.ChevronUp,title:"Upload",accessoryTitle:`${ze(t.up)}/s`}),_jsx(re.List.Item,{key:"2",icon:re.Icon.ChevronDown,title:"Download",accessoryTitle:`${ze(t.down)}/s`}),_jsx(re.List.Item,{key:"3",icon:re.Icon.Upload,title:"Upload Total",accessoryTitle:`${ze(o.uploadTotal)}`}),_jsx(re.List.Item,{key:"4",icon:re.Icon.Download,title:"Download Total",accessoryTitle:`${ze(o.downloadTotal)}`}),_jsx(re.List.Item,{key:"5",icon:re.Icon.LevelMeter,title:"Active Connections",accessoryTitle:`${o.connections.length}`})):_jsx(_jsxFragment,null))}var ie=require("@raycast/api"),Ye=require("react");async function Za(){return(await(await Pt({endpoint:"/proxies"})).json()).proxies}async function Ja(){return(await(await Pt({endpoint:"/rules"})).json()).rules}async function el(){return await(await Pt({endpoint:"/configs"})).json()}async function tl(s){let t=await Pt({endpoint:"/configs",method:"PATCH",body:s});if(t.status===400)throw new Error("Format error");if(t.status===404)throw new Error("Proxy not found");if(t.status!==204)throw new Error(`Unexpected status code: ${t.status}`)}async function rl(s,t){let n=await Pt({endpoint:`/proxies/${s}`,method:"PUT",body:{name:t}});if(n.status===400)throw new Error("Format error");if(n.status===404)throw new Error("Proxy not found");if(n.status!==204)throw new Error(`Unexpected status code: ${n.status}`)}function Tc({name:s,proxies:t,current:n,refresh:o,selectable:a}){let[l,f]=(0,Ye.useState)(n),[m,d]=(0,Ye.useState)(!1);return _jsx(ie.List,{isLoading:m},t.map((h,b)=>a?_jsx(ie.List.Item,{key:b,title:h,accessoryTitle:h==l?"Current":"",actions:_jsx(ie.ActionPanel,null,_jsx(ie.Action,{title:"Select",onAction:async()=>{try{d(!0),await rl(s,h),o(),f(h)}catch(g){_e(g)}finally{d(!1)}}}))}):_jsx(ie.List.Item,{key:b,title:h,accessoryTitle:h==l?"Current":""})))}var Ec=["Selector","URLTest","Fallback","LoadBalance","Relay"];function xs(){let[s,t]=(0,Ye.useState)(!0),[n,o]=(0,Ye.useState)([]),[a,l]=(0,Ye.useState)(!1);return(0,Ye.useEffect)(()=>{(async()=>{try{t(!0);let m=await Za(),d=[];for(let[b,g]of Object.entries(n))b==="GLOBAL"&&g.all&&(d=g.all);let h=Object.values(m).filter(({type:b})=>Ec.includes(b)).sort(({name:b},{name:g})=>d.indexOf(b)-d.indexOf(g));o(h)}catch(m){_e(m)}finally{t(!1)}})()},[a]),_jsx(ie.List,{isLoading:s},n.map((f,m)=>_jsx(ie.List.Item,{key:m,title:f.name,subtitle:f.type,accessoryTitle:f.now,actions:_jsx(ie.ActionPanel,null,_jsx(ie.Action.Push,{title:"Show Proxies",target:_jsx(Tc,{name:f.name,proxies:f.all,current:f.now,refresh:()=>l(!a),selectable:f.type=="Selector"})}))})))}var pr=require("@raycast/api"),Bt=require("react");var nl=["Domain","DomainSuffix","DomainKeyword","GeoIP","IPCIDR","SrcIPCIDR","SrcPort","DstPort","Process","ProcessPath","Match"];function Bs(){let[s,t]=(0,Bt.useState)(!0),[n,o]=(0,Bt.useState)([]),[a,l]=(0,Bt.useState)(nl[0]);return(0,Bt.useEffect)(()=>{(async()=>{try{t(!0);let m=await Ja();o(m)}catch(m){_e(m)}finally{t(!1)}})()},[]),_jsx(pr.List,{isLoading:s,searchBarAccessory:_jsx(pr.List.Dropdown,{tooltip:"Type",storeValue:!1,onChange:f=>l(f)},nl.map((f,m)=>_jsx(pr.List.Dropdown.Item,{key:m,title:f,value:f})))},n.filter(f=>f.type===a).map((f,m)=>_jsx(pr.List.Item,{key:m,title:f.payload,subtitle:f.type,accessoryTitle:f.proxy})))}var lt=require("@raycast/api"),Ot=require("react");var Cc=["rule","global","direct","script"];function Os(){let[s,t]=(0,Ot.useState)(!1),[n,o]=(0,Ot.useState)(""),[a,l]=(0,Ot.useState)(!1);return(0,Ot.useEffect)(()=>{(async()=>{try{t(!0);let m=await el();o(m.mode)}catch(m){_e(m)}finally{t(!1)}})()},[a]),_jsx(lt.List,{isLoading:s},Cc.map((f,m)=>_jsx(lt.List.Item,{key:m,title:Fi(f),accessoryTitle:f==n?"Current":"",actions:_jsx(lt.ActionPanel,null,_jsx(lt.Action,{title:"Select",onAction:async()=>{try{t(!0),await tl({mode:f}),l(!a)}catch(d){_e(d)}finally{t(!1)}}}))})))}var sl={Overview:ks,Proxies:xs,Backends:us,Conns:vs,Rules:Bs,Logs:As,Mode:Os};function ol(){return _jsx(sl.Mode,null)}module.exports=qu(Pc);0&&(module.exports={});
/*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */
/*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */
